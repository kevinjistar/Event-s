
## ğŸ“‹ Ã‰tape 2 : IntÃ©gration Documents RÃ©fÃ©rents

**Instruction pour GAS (Ã  envoyer APRÃˆS validation Ã‰tape 1.3) :**

```markdown
# INTÃ‰GRATION DOCUMENTS RÃ‰FÃ‰RENTS

## Objectif
IntÃ©grer les 5 documents rÃ©fÃ©rents dans initialDocuments.ts et valider leur accessibilitÃ©.

## Documents Ã  IntÃ©grer

Je vais te fournir 5 documents en texte brut. Pour chaque document :

### Document 1 : Identity.txt
[Je fournirai le contenu complet]

### Document 2 : Architecture_&_Code.txt
[Je fournirai le contenu complet]

### Document 3 : Design_System_&_Charte_UX.txt
[Je fournirai le contenu complet]

### Document 4 : Overview.txt
[Je fournirai le contenu complet]

### Document 5 : Workflow.md
[Je fournirai le contenu complet]

## Actions Requises

### 1. Mise Ã  jour initialDocuments.ts
Remplace le contenu de src/data/initialDocuments.ts :

```typescript
export const initialDocuments: Record<string, string> = {
  "identity": `

---
Version: 1.0.0
Date: 2025-12-08
Changelog:
  - 1.0.0 (2025-12-08): Initialisation du document
Breaking Changes: Aucun depuis 1.0.0
---
RÃ¨gle de versioning :
	â€¢	Major (X.0.0) : Pivot stratÃ©gique (Identity modifiÃ©)
	â€¢	Minor (1.X.0) : Nouvelle feature majeure (Architecture/Design modifiÃ©)
	â€¢	Patch (1.2.X) : Adaptation technique (ex: Replit-specific)
---
# Eventâ€™s â€” Document de RÃ©fÃ©rence & IdentitÃ© Produit

**Version 1.0 | Document Fondateur**  
*Ce document dÃ©finit lâ€™identitÃ©, la vision et les principes directeurs immuables de Eventâ€™s.*

-----

## 1. IDENTITÃ‰ & POSITIONNEMENT

### Vision

**Eventâ€™s transforme les intentions sociales en Ã©vÃ©nements rÃ©els.**

### Mission

Maximiser le taux de conversion entre â€œOn devrait se voirâ€ et les moments vÃ©cus ensemble.

### Positionnement stratÃ©gique

Eventâ€™s nâ€™est pas un rÃ©seau social. Eventâ€™s nâ€™est pas un outil de gestion de projet.  
**Eventâ€™s est un accÃ©lÃ©rateur social** â€” le chainon manquant entre la conversation et lâ€™action.

### Proposition de valeur unique

â€œMoins de bla-bla, plus de vrais moments.â€

Eventâ€™s augmente WhatsApp et Doodle, il ne les remplace pas. Il doit Ãªtre complÃ©mentaire, jamais disruptif.

-----

## 2. MÃ‰TRIQUE DE SUCCÃˆS ABSOLUE

### KPI Principal (North Star Metric)

**Taux dâ€™Ã©vÃ©nements rÃ©ellement rÃ©alisÃ©s / Ã©vÃ©nements crÃ©Ã©s**

**Cible minimale :** 60%

Tout ce qui nâ€™optimise pas cette mÃ©trique est secondaire ou superflu.

### MÃ©triques secondaires

- Temps moyen entre crÃ©ation et confirmation dâ€™Ã©vÃ©nement (objectif : <48h)
- Taux de retour utilisateur sur 30 jours (objectif : >70%)
- Nombre moyen de clics pour confirmer un Ã©vÃ©nement (objectif : <15)

-----

## 3. PRINCIPES DIRECTEURS IMMUABLES

### Principe 1 : â€œFast First, Detailed Laterâ€

Eventâ€™s doit permettre deux modes dâ€™utilisation coexistants :

- **Mode Express :** CrÃ©er â€œBiÃ¨res ce soir ?â€ en 3 clics maximum
- **Mode Planification :** GÃ©rer un week-end complexe avec votes, contributions et budget

Le Mode Express est prioritaire. Si une fonctionnalitÃ© ralentit ce parcours, elle doit Ãªtre rejetÃ©e ou rendue optionnelle.

### Principe 2 : â€œSimplicitÃ© radicaleâ€

Chaque clic, chaque Ã©cran, chaque fonctionnalitÃ© doit avoir une justification claire.  
**Test de validation :** Si lâ€™action prend plus de temps sur Eventâ€™s que sur WhatsApp, lâ€™UX a Ã©chouÃ©.

### Principe 3 : â€œJamais bloquer la conversationâ€

Le chat doit Ãªtre accessible immÃ©diatement dÃ¨s la crÃ©ation dâ€™un Ã©vÃ©nement.  
Les votes et actions sont Ã©pinglÃ©s en haut, mais ne bloquent jamais la discussion libre.

**RÃ¨gle dâ€™or :** Si un utilisateur ouvre WhatsApp en parallÃ¨le, Eventâ€™s a perdu.

### Principe 4 : â€œValeur immÃ©diateâ€

Lâ€™utilisateur doit percevoir le bÃ©nÃ©fice dÃ¨s le premier Ã©vÃ©nement organisÃ©.  
Pas de courbe dâ€™apprentissage. Pas de tutoriel obligatoire.

### Principe 5 : â€œItÃ©ration rapideâ€

Mieux vaut un MVP en 6 semaines quâ€™un produit parfait jamais fini.  
Chaque feature doit Ãªtre testÃ©e avec de vrais utilisateurs avant dâ€™Ãªtre Ã©tendue.

-----

## 4. ARCHITECTURE CONCEPTUELLE

### Groupe cible

**4 Ã  12 personnes** â€” Le cercle dâ€™amis proche.

Eventâ€™s nâ€™est pas conÃ§u pour les communautÃ©s larges (50+ personnes) en V1.

### Flux utilisateur fondamental

#### Onboarding (minimal)

**Obligatoire :**

- PrÃ©nom
- Photo de profil (optionnel mais encouragÃ©)

**Optionnel (ajoutÃ© progressivement) :**

- Date dâ€™anniversaire
- DisponibilitÃ©s gÃ©nÃ©rales (widget visuel : semaine/weekend, jour/soir)
- Stats et badges (auto-gÃ©nÃ©rÃ©s par lâ€™usage)

**Interdit Ã  lâ€™onboarding :**

- Formulaires longs
- Questionnaires de passions/intÃ©rÃªts
- Demandes dâ€™autorisation multiples

#### SystÃ¨me de vote (approche canonique)

**Rejet dÃ©finitif :** Entonnoir sÃ©quentiel Mois â†’ Semaine â†’ Jour â†’ Heure

**Approche validÃ©e :** Sondage de crÃ©neaux type Doodle++

1. Le crÃ©ateur ET les membres proposent 2-5 crÃ©neaux complets (date + heure dÃ©but/fin)
1. Vote unique en trois options :

- âœ… **â€œJe peuxâ€** (vert)
- ğŸ¤” **â€œSi nÃ©cessaireâ€** (orange)
- âŒ **â€œPas dispoâ€** (rouge)

1. Visualisation par heatmap : les crÃ©neaux optimaux sâ€™illuminent en vert foncÃ©
1. Validation intelligente :

- Auto (dÃ©faut) : Si un crÃ©neau atteint 80% de â€œJe peuxâ€
- Manuelle : Le crÃ©ateur choisit parmi le top 3
- Deadline : 48h avant la date la plus proche â†’ notification â€œConfirme ta prÃ©sence !â€

#### Gestion des â€œPeut-Ãªtreâ€ (killer feature)

Le â€œpeut-Ãªtreâ€ est souvent un â€œnon poliâ€ qui bloque les dÃ©cisions.

**Solutions intÃ©grÃ©es :**

- Option **â€œSoft commitâ€** : â€œJe viens si au moins X personnes viennentâ€
- Notification progressive : â€œIl reste 24h pour confirmerâ€
- Conversion automatique : AprÃ¨s deadline, â€œPeut-Ãªtreâ€ â†’ â€œNonâ€ sauf confirmation explicite

-----

## 5. Ã‰TATS Dâ€™Ã‰VÃ‰NEMENT CANONIQUES

|Ã‰tat               |Description                |CTA utilisateur      |Badge|
|-------------------|---------------------------|---------------------|-----|
|**ğŸ’¡ IdÃ©e**         |Proposition non validÃ©e    |â€œVoter mon intÃ©rÃªtâ€  |ğŸŸ¡    |
|**ğŸ“… Vote en cours**|Sondage de dates actif     |â€œVoter mes disposâ€   |ğŸŸ     |
|**â³ En validation**|Choix majoritaire identifiÃ©|â€œAttendre validationâ€|ğŸŸ£    |
|**âœ… ConfirmÃ©**     |Tout verrouillÃ©            |â€œVoir dÃ©tailsâ€ + ğŸ“…   |ğŸŸ¢    |
|**ğŸ“¸ PassÃ©**        |Ã‰vÃ©nement terminÃ©          |â€œAjouter photosâ€     |âšª    |
|**âŒ AnnulÃ©**       |Ã‰vÃ©nement annulÃ©           |â€”                    |ğŸ”´    |

**RÃ¨gle :** Chaque Ã©tat nâ€™a quâ€™une seule action principale pour Ã©viter la paralysie du choix.

-----

## 6. RÃ”LES & MODÃ‰RATION

### RÃ´les dÃ©finis

|RÃ´le               |Permissions                                |Acquisition         |
|-------------------|-------------------------------------------|--------------------|
|**CrÃ©ateur**       |Lance lâ€™Ã©vÃ©nement, valide les choix, modÃ¨re|CrÃ©e lâ€™Ã©vÃ©nement    |
|**Co-organisateur**|Idem crÃ©ateur                              |NommÃ© par crÃ©ateur  |
|**Membre**         |Vote, propose options, discute             |Appartient au groupe|

### MÃ©canismes anti-blocage

- **SystÃ¨me de â€œPokeâ€** : Les membres peuvent notifier le crÃ©ateur avec â€œâ° On attend ta validation !â€
- **Validation automatique** : Si quorum atteint + 24h sans rÃ©action du crÃ©ateur
- **Transfert de modÃ©ration** : Si le crÃ©ateur quitte le groupe, il doit dÃ©signer un successeur ou le systÃ¨me propose un vote

**Principe :** Le crÃ©ateur ne doit jamais Ãªtre un point de blocage unique.

-----

## 7. GESTION FINANCIÃˆRE (rÃ¨gles absolues)

### âŒ INTERDIT EN TOUTE CIRCONSTANCE

- Stocker des numÃ©ros de compte bancaire (IBAN/RIB)
- GÃ©rer de lâ€™argent rÃ©el directement dans lâ€™application
- Promettre des fonctionnalitÃ©s de paiement intÃ©grÃ© en V1

### âœ… APPROCHES AUTORISÃ‰ES

**MVP (V1) :** Tracker de dettes simple

- Liste â€œQui doit combien Ã  quiâ€
- Checkbox â€œJâ€™ai payÃ© ma partâ€
- Aucune transaction financiÃ¨re rÃ©elle

**V2 :** IntÃ©gration paiement tiers

- Champ â€œLien de paiementâ€ : Organisateur colle son lien Lydia/PayPal/Revolut/Tricount
- Optionnel : IntÃ©gration API Stripe pour cagnotte Ã©vÃ©nementielle (avec validation lÃ©gale)

**Justification :** Ã‰viter tout cauchemar lÃ©gal, technique et de sÃ©curitÃ© en phase MVP.

-----

## 8. ARCHITECTURE TECHNIQUE FIREBASE

### Collections Firestore (structure canonique)

```javascript
users/
  {userId}/
    name: string
    photoURL: string
    fcmToken: string
    preferences: {
      availabilities: string // "weekdays" | "weekends" | "both"
    }
    stats: {
      eventsCreated: number
      eventsAttended: number
      reliabilityScore: number // 0-100
    }

groups/
  {groupId}/
    name: string
    description: string
    privacy: string // "public" | "private"
    members: [
      {
        userId: string
        role: string // "creator" | "co-organizer" | "member"
      }
    ]
    createdAt: timestamp

events/
  {eventId}/
    groupId: string
    title: string
    description: string
    status: string // "idea" | "voting" | "pending_validation" | "confirmed" | "past" | "cancelled"
    createdBy: string
    organizerIds: [string]
    
    dateOptions: [
      {
        optionId: string
        start: timestamp
        end: timestamp
        votes: [
          {
            userId: string
            response: string // "yes" | "maybe" | "no"
          }
        ]
      }
    ]
    
    chosenDate: {
      start: timestamp
      end: timestamp
    }
    
    contributions: [
      {
        item: string
        takenBy: string // userId
      }
    ]
    
    expenses: {
      link: string
      amount: number
      whoPaid: [string] // array of userId
    }
    
    messages/ (subcollection)
      {messageId}/
        senderId: string
        text: string
        timestamp: timestamp
```

### RÃ¨gles de sÃ©curitÃ© Firestore (immuables)

- Seuls les membres dâ€™un groupe peuvent lire/Ã©crire ses Ã©vÃ©nements
- Seuls crÃ©ateur et co-organisateurs peuvent changer le statut dâ€™un Ã©vÃ©nement
- Tout membre peut proposer des options de date
- Tout membre peut voter

-----

## 9. NAVIGATION & ARCHITECTURE Dâ€™INFORMATION

### Structure dâ€™application canonique

```
ğŸ“± Event's
â”‚
â”œâ”€â”€ ğŸ  Dashboard (HUB CENTRAL â€” point d'entrÃ©e unique)
â”‚   â”œâ”€â”€ ğŸ”” Actions requises (priorisÃ©es en haut)
â”‚   â”œâ”€â”€ ğŸ“… Prochains Ã©vÃ©nements confirmÃ©s
â”‚   â””â”€â”€ ğŸ’¡ Suggestions IA (optionnel V2+)
â”‚
â”œâ”€â”€ ğŸ‘¤ Mon Profil
â”‚   â”œâ”€â”€ Infos personnelles
â”‚   â”œâ”€â”€ ğŸ“Š Stats & ğŸ† Badges
â”‚   â””â”€â”€ â° DisponibilitÃ©s gÃ©nÃ©rales
â”‚
â”œâ”€â”€ ğŸ‘¥ Mes Groupes
â”‚   â””â”€â”€ [Groupe X]
â”‚       â”œâ”€â”€ ğŸ’¬ Discussion gÃ©nÃ©rale
â”‚       â”œâ”€â”€ ğŸ“… Ã‰vÃ©nements du groupe
â”‚       â””â”€â”€ ğŸ‘¥ Membres
â”‚
â”œâ”€â”€ ğŸ‰ Mes Ã‰vÃ©nements (vue transversale tous groupes)
â”‚   â”œâ”€â”€ Filtres : par groupe, par statut
â”‚   â”œâ”€â”€ ğŸ“… Vue Calendrier mensuel
â”‚   â””â”€â”€ ğŸ“‹ Vue Liste
â”‚
â””â”€â”€ ğŸ” Recherche (V2+)
    â”œâ”€â”€ ğŸ‘¤ Amis
    â””â”€â”€ ğŸ‘¥ Groupes publics
```

**Principe directeur :** Le Dashboard est le cerveau. Si bien conÃ§u, â€œMes Ã‰vÃ©nementsâ€ devient un simple filtre avancÃ©.

-----

## 10. INTERFACE CHAT & DISCUSSION

### Architecture dâ€™interface (standard immuable)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Œ ZONE DE VOTE (Ã©pinglÃ©e, fixe)    â”‚
â”‚   ğŸ—“ï¸ Dates proposÃ©es [Vote ici]    â”‚
â”‚   ğŸ’ Ã€ apporter [Qui prend quoi ?]  â”‚
â”‚   ğŸ’° DÃ©penses [Qui a payÃ© ?]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¬ DISCUSSION (scrollable)          â”‚
â”‚   Alice : "On se retrouve oÃ¹ ?"     â”‚
â”‚   Bob : "Je propose chez moi"       â”‚
â”‚   [Messages dÃ©filants...]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**RÃ¨gle absolue :** Le chat est ouvert dÃ¨s la crÃ©ation de lâ€™Ã©vÃ©nement. Jamais de blocage.

-----

## 11. ROADMAP MVP (Phases dÃ©finies)

### Phase 1 : Core Loop (4-6 semaines) â€” INVIOLABLE

**Objectif :** Organiser 1 Ã©vÃ©nement rÃ©el dans 5 groupes de 4-6 personnes

**Features obligatoires :**

- Auth Firebase (Google + Email)
- CrÃ©er/rejoindre groupe (lien dâ€™invitation)
- CrÃ©er Ã©vÃ©nement simple (titre + description + 2-3 crÃ©neaux)
- Vote sur crÃ©neaux (interface Doodle-like)
- Validation manuelle par crÃ©ateur
- Chat dÃ©diÃ© Ã  lâ€™Ã©vÃ©nement
- Dashboard : â€œActions requisesâ€ + â€œProchains Ã©vÃ©nementsâ€

**CritÃ¨re de succÃ¨s :** Taux de conversion >50% (Ã©vÃ©nements crÃ©Ã©s â†’ Ã©vÃ©nements rÃ©alisÃ©s)

**Features INTERDITES en Phase 1 :**

- Vue Kanban
- Algorithmes de passions
- Upload de photos souvenirs
- IA / suggestions automatiques
- IntÃ©gration calendrier externe
- Groupes publics

### Phase 2 : Si traction (2-3 mois)

**DÃ©clencheur :** Taux de conversion Phase 1 >50% + 100 utilisateurs actifs

**Features autorisÃ©es :**

- Vue Calendrier mensuel
- SystÃ¨me â€œÃ€ apporterâ€ (liste collaborative)
- Tracker dÃ©penses simple
- Notifications push intelligentes
- Export vers Google/Apple Calendar
- Validation automatique (quorum)

### Phase 3 : Polish & Scale (6+ mois)

**DÃ©clencheur :** Taux de conversion Phase 2 >60% + 500 utilisateurs actifs

**Features autorisÃ©es :**

- Vue Kanban
- Co-organisateurs & transfert modÃ©ration
- IntÃ©gration paiement (Lydia/Stripe avec validation lÃ©gale)
- IA : suggestions, rÃ©sumÃ©s, dÃ©tection conflits
- Galerie photos post-Ã©vÃ©nement
- Groupes publics + recherche
- Templates dâ€™Ã©vÃ©nements
- Gamification avancÃ©e

-----

## 12. INTÃ‰GRATION IA (Google AI Studio) â€” Principes

### Philosophie

Lâ€™IA assiste, elle ne dÃ©cide jamais.  
Lâ€™IA amÃ©liore lâ€™expÃ©rience, elle ne la remplace pas.

### Cas dâ€™usage validÃ©s (Phase 2+)

|FonctionnalitÃ©            |DÃ©clencheur       |Valeur utilisateur                                          |
|--------------------------|------------------|------------------------------------------------------------|
|**DÃ©tection conflits**    |Ã‰vÃ©nement proposÃ© |â€œâš ï¸ Tu as dÃ©jÃ  â€˜Anniversaire Mamanâ€™ le 15 juinâ€              |
|**Suggestions proactives**|MÃ©tÃ©o + historique|â€œâ˜€ï¸ Il fait beau samedi, rando au Lac X ?â€                   |
|**RÃ©sumÃ© discussion**     |Bouton manuel     |Extrait dÃ©cisions clÃ©s du chat                              |
|**Smart defaults**        |CrÃ©ation Ã©vÃ©nement|SuggÃ¨re crÃ©neaux basÃ©s sur dispo groupe                     |
|**Analyseur dâ€™engagement**|Post-Ã©vÃ©nement    |â€œ48% de participation ce mois â†’ Tester dâ€™autres activitÃ©s ?â€|

### Cas dâ€™usage INTERDITS

- CrÃ©ation automatique dâ€™Ã©vÃ©nements sans validation humaine
- Validation automatique de dates sans quorum ou consentement utilisateur
- Suggestions basÃ©es sur des donnÃ©es privÃ©es non consenties
- ModÃ©ration automatique de discussions

-----

## 13. PIÃˆGES Ã€ Ã‰VITER (Liste dâ€™interdiction)

|âŒ PiÃ¨ge                             |ğŸ’¥ ConsÃ©quence            |âœ… Solution validÃ©e                |
|------------------------------------|-------------------------|----------------------------------|
|Profil trop dÃ©taillÃ© Ã  lâ€™inscription|Abandon onboarding (70%) |PrÃ©nom + photo uniquement         |
|Chat bloquÃ© avant validation        |Fuite vers WhatsApp      |Chat ouvert dÃ¨s crÃ©ation          |
|Entonnoir de vote trop long         |DÃ©couragement utilisateur|Sondage crÃ©neaux en une fois      |
|ModÃ©rateur unique absent            |Ã‰vÃ©nement gelÃ©           |Co-organisateurs + validation auto|
|Gestion argent rÃ©el en V1           |Cauchemar lÃ©gal/technique|Lien externe ou tracker simple    |
|Trop de features en V1              |DÃ©veloppement infini     |MVP strict 4-6 semaines           |
|Feature â€œcoolâ€ sans usage rÃ©el      |ComplexitÃ© inutile       |Tester avant dâ€™implÃ©menter        |
|Tutorial obligatoire                |Friction onboarding      |Interface intuitive sans tutorial |

-----

## 14. QUESTIONS CRITIQUES TRANCHÃ‰ES

### Metric de succÃ¨s

**Nombre dâ€™Ã©vÃ©nements crÃ©Ã©s OU rÃ©alisÃ©s ?**  
â†’ **RÃ©ponse : RÃ©alisÃ©s** (sinon juste du bruit)

### Taille groupe cible

**3 ? 10 ? 50 personnes ?**  
â†’ **RÃ©ponse : 4-12** (cercle dâ€™amis proche)

### Cold start problem

**Comment engager si les amis ne sont pas lÃ  ?**  
â†’ **RÃ©ponse : Invitation virale** (â€œRejoins Eventâ€™s pour voter sur notre soirÃ©e !â€)

### MonÃ©tisation

**Freemium ? Premium ? PublicitÃ© ?**  
â†’ **RÃ©ponse MVP : Gratuit total**. MonÃ©tisation en Phase 3 uniquement.

### Plateforme prioritaire

**iOS ? Android ? Web ?**  
â†’ **RÃ©ponse : Web-first (PWA)**, puis mobile natif si traction.

-----

## 15. PRINCIPE Dâ€™OR FINAL

> **â€œEventâ€™s doit disparaÃ®tre derriÃ¨re lâ€™action. Dire â€˜On organise Ã§a sur Eventâ€™s !â€™ doit Ãªtre plus simple quâ€™un thread WhatsApp, jamais plus compliquÃ©.â€**

### Les 3 Commandements

1. **SimplicitÃ© radicale** â†’ Chaque clic doit avoir une justification
1. **Valeur immÃ©diate** â†’ BÃ©nÃ©fice visible dÃ¨s le 1er Ã©vÃ©nement
1. **ItÃ©ration rapide** â†’ MVP en 6 semaines > produit parfait jamais fini

-----

## 16. AVANTAGE COMPÃ‰TITIF (Positionnement marchÃ©)

**ProblÃ¨me rÃ©solu :**  
Organiser entre amis est frustrant. WhatsApp est chaotique, Doodle est froid, Facebook Events est complexe.

**Solution Eventâ€™s :**  
Lâ€™Ã©quilibre parfait entre la chaleur dâ€™une conversation WhatsApp et lâ€™efficacitÃ© dâ€™un outil de planification.

**DiffÃ©renciation :**

- **vs WhatsApp :** Structure et clartÃ© sans perdre la spontanÃ©itÃ©
- **vs Doodle :** Social et conversationnel, pas juste transactionnel
- **vs Facebook Events :** IntimitÃ© du groupe dâ€™amis, pas broadcast public

-----

## 17. MODIFICATIONS DE CE DOCUMENT

Ce document ne peut Ãªtre modifiÃ© que dans les cas suivants :

1. **Pivot stratÃ©gique validÃ©** aprÃ¨s Ã©chec rÃ©pÃ©tÃ© du MVP (taux conversion <30% sur 3 mois)
1. **Contrainte technique imprÃ©vue** rendant lâ€™architecture impossible
1. **Changement lÃ©gal majeur** affectant le modÃ¨le (ex: RGPD, lois paiement)
1. **Validation utilisateur massive** dâ€™une approche alternative (taux conversion >80%)

Toute modification doit Ãªtre documentÃ©e avec :

- Date de modification
- Raison du changement
- Version prÃ©cÃ©dente archivÃ©e
- Validation par le product owner

-----

**Version 1.0 â€” Document Fondateur Eventâ€™s**  
*DerniÃ¨re mise Ã  jour : 7 DÃ©cembre 2025*  
*Statut : Actif et immuable sauf conditions Section 17*

-----

**Ce document est la source unique de vÃ©ritÃ© pour Eventâ€™s. Toute dÃ©cision produit, technique ou design doit Ãªtre alignÃ©e avec ces principes.**
`,
  "architecture": `

---
Version: 1.0.0
Date: 2025-12-08
Changelog:
  - 1.0.0 (2025-12-08): Initialisation du document
Breaking Changes: Aucun depuis 1.0.0
---
RÃ¨gle de versioning :
	â€¢	Major (X.0.0) : Pivot stratÃ©gique (Identity modifiÃ©)
	â€¢	Minor (1.X.0) : Nouvelle feature majeure (Architecture/Design modifiÃ©)
	â€¢	Patch (1.2.X) : Adaptation technique (ex: Replit-specific)
---
# Eventâ€™s â€” Architecture Technique & Standards de Code

** Document de RÃ©fÃ©rence Technique**  
*Ce document dÃ©finit lâ€™architecture, les standards de dÃ©veloppement et les bonnes pratiques immuables pour Eventâ€™s.*

-----

## 1. PHILOSOPHIE TECHNIQUE

### Vision Technique

**â€œSimple, Scalable, Secureâ€**

Eventâ€™s doit Ãªtre construit avec des technologies Ã©prouvÃ©es, une architecture claire et une maintenabilitÃ© maximale.

### Principes Fondamentaux

#### 1. **Convention over Configuration**

- Structure de projet standardisÃ©e
- Nommage cohÃ©rent et prÃ©visible
- Moins de dÃ©cisions arbitraires, plus de patterns Ã©tablis

#### 2. **Progressive Enhancement**

- Lâ€™app doit fonctionner sans JavaScript avancÃ©
- Enrichissement progressif des fonctionnalitÃ©s
- Graceful degradation sur anciens navigateurs

#### 3. **Performance First**

- Time to Interactive < 3s sur 3G
- Bundle JavaScript < 200KB (gzipped)
- Lighthouse Score > 90

#### 4. **Security by Design**

- Validation cÃ´tÃ© client ET serveur
- Firestore Security Rules strictes
- Authentification sÃ©curisÃ©e (pas de stockage de tokens en clair)

-----

## 2. STACK TECHNIQUE

### Frontend

**Framework Principal :** React 18+ avec TypeScript

**Raisons du choix :**

- Ã‰cosystÃ¨me mature et stable
- Performance optimale avec Concurrent Mode
- Type safety avec TypeScript
- Courbe dâ€™apprentissage acceptable

**Build Tool :** Vite 5+

**Raisons du choix :**

- Hot Module Replacement ultra-rapide
- Build optimisÃ© pour production
- Support natif TypeScript
- Configuration minimale

**Styling :** Tailwind CSS 3+

**Raisons du choix :**

- Utility-first approach (cohÃ©rent avec Design System)
- Purge CSS automatique
- Pas de conflits de nommage
- Customisation complÃ¨te via config

**State Management :** React Context + Zustand (si nÃ©cessaire)

**Raisons du choix :**

- Context API suffit pour MVP
- Zustand si besoin dâ€™Ã©tat global complexe (lÃ©ger, simple)
- Pas de Redux (trop verbose pour notre cas)

**Routing :** React Router v6+

**Raisons du choix :**

- Standard de facto React
- Nested routes pour architecture modulaire
- Lazy loading natif

**Librairies UI Additionnelles :**

- **Framer Motion** : Animations fluides
- **React Hook Form** : Gestion formulaires performante
- **date-fns** : Manipulation dates (plus lÃ©ger que moment.js)
- **Lucide React** : IcÃ´nes (cohÃ©rent avec Design System)

### Backend (BaaS)

**Firebase Platform :**

- **Authentication** : Gestion utilisateurs (Google OAuth, Email/Password)
- **Firestore** : Base de donnÃ©es NoSQL temps rÃ©el
- **Cloud Functions** : Logique serveur (Node.js 20)
- **Cloud Storage** : Photos de profil, images Ã©vÃ©nements
- **Firebase Hosting** : DÃ©ploiement frontend (PWA-ready)
- **Firebase Cloud Messaging (FCM)** : Notifications push

**Raisons du choix Firebase :**

- Time to market rapide (pas de backend Ã  construire)
- ScalabilitÃ© automatique
- Real-time synchronisation native
- SÃ©curitÃ© robuste avec Security Rules
- CoÃ»t initial trÃ¨s bas (Free tier gÃ©nÃ©reux)

### IA & Services Externes

**Google AI Studio (Gemini API)** : IA conversationnelle, suggestions, rÃ©sumÃ©s

**Raisons du choix :**

- IntÃ©gration native Firebase/Google Cloud
- ModÃ¨le Gemini performant et Ã©conomique
- MultimodalitÃ© (texte + images si besoin V2+)

**Services Additionnels (Phase 2+) :**

- **Google Maps API** : Localisation lieux dâ€™Ã©vÃ©nements
- **OpenWeatherMap API** : Suggestions basÃ©es mÃ©tÃ©o
- **Stripe API** : Paiements (si Phase 3)

### DevOps & CI/CD

**Version Control :** Git + GitHub

**CI/CD :** GitHub Actions

**Workflow :**

```yaml
# .github/workflows/deploy.yml
name: Deploy to Firebase
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: npm ci
      - run: npm run build
      - run: npm run test
      - uses: FirebaseExtended/action-hosting-deploy@v0
```

**Monitoring :** Firebase Performance Monitoring + Analytics

**Error Tracking :** Sentry (gratuit jusquâ€™Ã  5K events/mois)

-----

## 3. ARCHITECTURE FIRESTORE

### Collections & Documents

```javascript
// Structure Firestore canonique
firestore/
â”œâ”€â”€ users/
â”‚   â””â”€â”€ {userId}
â”‚       â”œâ”€â”€ name: string
â”‚       â”œâ”€â”€ email: string
â”‚       â”œâ”€â”€ photoURL: string
â”‚       â”œâ”€â”€ fcmToken: string
â”‚       â”œâ”€â”€ createdAt: timestamp
â”‚       â”œâ”€â”€ preferences: {
â”‚       â”‚   availabilities: "weekdays" | "weekends" | "both"
â”‚       â”‚   notificationsEnabled: boolean
â”‚       â”‚   language: "fr" | "en"
â”‚       â”‚ }
â”‚       â””â”€â”€ stats: {
â”‚           eventsCreated: number
â”‚           eventsAttended: number
â”‚           reliabilityScore: number // 0-100
â”‚         }
â”‚
â”œâ”€â”€ groups/
â”‚   â””â”€â”€ {groupId}
â”‚       â”œâ”€â”€ name: string
â”‚       â”œâ”€â”€ description: string
â”‚       â”œâ”€â”€ privacy: "public" | "private"
â”‚       â”œâ”€â”€ coverPhotoURL: string
â”‚       â”œâ”€â”€ createdBy: string // userId
â”‚       â”œâ”€â”€ createdAt: timestamp
â”‚       â””â”€â”€ members: [
â”‚           {
â”‚             userId: string
â”‚             role: "creator" | "co-organizer" | "member"
â”‚             joinedAt: timestamp
â”‚           }
â”‚         ]
â”‚
â”œâ”€â”€ events/
â”‚   â””â”€â”€ {eventId}
â”‚       â”œâ”€â”€ groupId: string
â”‚       â”œâ”€â”€ title: string
â”‚       â”œâ”€â”€ description: string
â”‚       â”œâ”€â”€ status: "idea" | "voting" | "pending_validation" | "confirmed" | "past" | "cancelled"
â”‚       â”œâ”€â”€ createdBy: string // userId
â”‚       â”œâ”€â”€ organizerIds: [string] // array of userId
â”‚       â”œâ”€â”€ createdAt: timestamp
â”‚       â”œâ”€â”€ updatedAt: timestamp
â”‚       â”‚
â”‚       â”œâ”€â”€ dateOptions: [
â”‚       â”‚   {
â”‚       â”‚     optionId: string
â”‚       â”‚     start: timestamp
â”‚       â”‚     end: timestamp
â”‚       â”‚     proposedBy: string // userId
â”‚       â”‚     votes: [
â”‚       â”‚       {
â”‚       â”‚         userId: string
â”‚       â”‚         response: "yes" | "maybe" | "no"
â”‚       â”‚         votedAt: timestamp
â”‚       â”‚       }
â”‚       â”‚     ]
â”‚       â”‚   }
â”‚       â”‚ ]
â”‚       â”‚
â”‚       â”œâ”€â”€ chosenDate: {
â”‚       â”‚   start: timestamp
â”‚       â”‚   end: timestamp
â”‚       â”‚   confirmedBy: string // userId
â”‚       â”‚   confirmedAt: timestamp
â”‚       â”‚ }
â”‚       â”‚
â”‚       â”œâ”€â”€ location: {
â”‚       â”‚   name: string
â”‚       â”‚   address: string
â”‚       â”‚   coordinates: { lat: number, lng: number }
â”‚       â”‚ }
â”‚       â”‚
â”‚       â”œâ”€â”€ contributions: [
â”‚       â”‚   {
â”‚       â”‚     contributionId: string
â”‚       â”‚     item: string
â”‚       â”‚     takenBy: string // userId ou null
â”‚       â”‚     quantity: number
â”‚       â”‚     addedAt: timestamp
â”‚       â”‚   }
â”‚       â”‚ ]
â”‚       â”‚
â”‚       â”œâ”€â”€ expenses: {
â”‚       â”‚   paymentLink: string
â”‚       â”‚   totalAmount: number
â”‚       â”‚   whoPaid: [string] // array of userId
â”‚       â”‚ }
â”‚       â”‚
â”‚       â””â”€â”€ messages/ (subcollection)
â”‚           â””â”€â”€ {messageId}
â”‚               â”œâ”€â”€ senderId: string
â”‚               â”œâ”€â”€ text: string
â”‚               â”œâ”€â”€ timestamp: timestamp
â”‚               â””â”€â”€ type: "text" | "system" // "system" pour notifications auto
â”‚
â””â”€â”€ notifications/
    â””â”€â”€ {userId}
        â””â”€â”€ {notificationId}
            â”œâ”€â”€ type: "vote_reminder" | "event_confirmed" | "new_message"
            â”œâ”€â”€ eventId: string
            â”œâ”€â”€ title: string
            â”œâ”€â”€ body: string
            â”œâ”€â”€ read: boolean
            â”œâ”€â”€ createdAt: timestamp
            â””â”€â”€ actionURL: string
```

### Indexes Composites Requis

```javascript
// firestore.indexes.json
{
  "indexes": [
    {
      "collectionGroup": "events",
      "queryScope": "COLLECTION",
      "fields": [
        { "fieldPath": "groupId", "order": "ASCENDING" },
        { "fieldPath": "status", "order": "ASCENDING" },
        { "fieldPath": "createdAt", "order": "DESCENDING" }
      ]
    },
    {
      "collectionGroup": "messages",
      "queryScope": "COLLECTION",
      "fields": [
        { "fieldPath": "timestamp", "order": "DESCENDING" }
      ]
    },
    {
      "collectionGroup": "notifications",
      "queryScope": "COLLECTION",
      "fields": [
        { "fieldPath": "read", "order": "ASCENDING" },
        { "fieldPath": "createdAt", "order": "DESCENDING" }
      ]
    }
  ]
}
```

### Firestore Security Rules

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Helper functions
    function isAuthenticated() {
      return request.auth != null;
    }
    
    function isOwner(userId) {
      return request.auth.uid == userId;
    }
    
    function isMemberOfGroup(groupId) {
      return exists(/databases/$(database)/documents/groups/$(groupId)) &&
             request.auth.uid in get(/databases/$(database)/documents/groups/$(groupId)).data.members[*].userId;
    }
    
    function isEventOrganizer(eventId) {
      let eventData = get(/databases/$(database)/documents/events/$(eventId)).data;
      return request.auth.uid == eventData.createdBy ||
             request.auth.uid in eventData.organizerIds;
    }
    
    // Users collection
    match /users/{userId} {
      allow read: if isAuthenticated();
      allow create: if isOwner(userId);
      allow update, delete: if isOwner(userId);
    }
    
    // Groups collection
    match /groups/{groupId} {
      allow read: if isAuthenticated() && 
                     (resource.data.privacy == "public" || isMemberOfGroup(groupId));
      allow create: if isAuthenticated();
      allow update: if isMemberOfGroup(groupId);
      allow delete: if isEventOrganizer(groupId);
    }
    
    // Events collection
    match /events/{eventId} {
      allow read: if isAuthenticated() && isMemberOfGroup(resource.data.groupId);
      allow create: if isAuthenticated() && isMemberOfGroup(request.resource.data.groupId);
      allow update: if isMemberOfGroup(resource.data.groupId);
      allow delete: if isEventOrganizer(eventId);
      
      // Messages subcollection
      match /messages/{messageId} {
        allow read: if isAuthenticated() && isMemberOfGroup(get(/databases/$(database)/documents/events/$(eventId)).data.groupId);
        allow create: if isAuthenticated() && isMemberOfGroup(get(/databases/$(database)/documents/events/$(eventId)).data.groupId);
        allow update, delete: if isOwner(resource.data.senderId);
      }
    }
    
    // Notifications collection
    match /notifications/{userId}/{notificationId} {
      allow read, write: if isOwner(userId);
    }
  }
}
```

-----

## 4. STRUCTURE DE PROJET FRONTEND

```
events-app/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â”œâ”€â”€ manifest.json
â”‚   â””â”€â”€ icons/
â”‚       â”œâ”€â”€ icon-192x192.png
â”‚       â””â”€â”€ icon-512x512.png
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.tsx                 # Point d'entrÃ©e
â”‚   â”œâ”€â”€ App.tsx                  # Component racine
â”‚   â”‚
â”‚   â”œâ”€â”€ assets/                  # Images, fonts statiques
â”‚   â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â””â”€â”€ fonts/
â”‚   â”‚
â”‚   â”œâ”€â”€ components/              # Composants rÃ©utilisables
â”‚   â”‚   â”œâ”€â”€ common/              # Composants gÃ©nÃ©riques
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Avatar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Badge.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Card.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Modal.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ layout/              # Layout components
â”‚   â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ BottomNav.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Sidebar.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ features/            # Composants mÃ©tier
â”‚   â”‚       â”œâ”€â”€ EventCard.tsx
â”‚   â”‚       â”œâ”€â”€ VoteModule.tsx
â”‚   â”‚       â”œâ”€â”€ ChatMessage.tsx
â”‚   â”‚       â””â”€â”€ GroupCard.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/                   # Pages (routes)
â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚   â”‚   â”œâ”€â”€ Profile.tsx
â”‚   â”‚   â”œâ”€â”€ GroupList.tsx
â”‚   â”‚   â”œâ”€â”€ GroupDetail.tsx
â”‚   â”‚   â”œâ”€â”€ EventList.tsx
â”‚   â”‚   â”œâ”€â”€ EventDetail.tsx
â”‚   â”‚   â””â”€â”€ Auth/
â”‚   â”‚       â”œâ”€â”€ Login.tsx
â”‚   â”‚       â””â”€â”€ Register.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                   # Custom React Hooks
â”‚   â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”‚   â”œâ”€â”€ useFirestore.ts
â”‚   â”‚   â”œâ”€â”€ useRealtimeEvents.ts
â”‚   â”‚   â”œâ”€â”€ useNotifications.ts
â”‚   â”‚   â””â”€â”€ useVoting.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ contexts/                # React Contexts
â”‚   â”‚   â”œâ”€â”€ AuthContext.tsx
â”‚   â”‚   â”œâ”€â”€ ThemeContext.tsx
â”‚   â”‚   â””â”€â”€ NotificationContext.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                # Services externes
â”‚   â”‚   â”œâ”€â”€ firebase.ts          # Config Firebase
â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”œâ”€â”€ firestore.service.ts
â”‚   â”‚   â”œâ”€â”€ storage.service.ts
â”‚   â”‚   â”œâ”€â”€ ai.service.ts        # Google AI Studio
â”‚   â”‚   â””â”€â”€ notifications.service.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                   # Utilitaires
â”‚   â”‚   â”œâ”€â”€ date.utils.ts
â”‚   â”‚   â”œâ”€â”€ validation.utils.ts
â”‚   â”‚   â”œâ”€â”€ format.utils.ts
â”‚   â”‚   â””â”€â”€ constants.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                   # TypeScript types
â”‚   â”‚   â”œâ”€â”€ user.types.ts
â”‚   â”‚   â”œâ”€â”€ group.types.ts
â”‚   â”‚   â”œâ”€â”€ event.types.ts
â”‚   â”‚   â””â”€â”€ common.types.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ styles/                  # Styles globaux
â”‚   â”‚   â”œâ”€â”€ index.css            # Tailwind imports
â”‚   â”‚   â””â”€â”€ animations.css       # Animations custom
â”‚   â”‚
â”‚   â””â”€â”€ config/                  # Configuration
â”‚       â”œâ”€â”€ env.ts               # Variables d'environnement
â”‚       â””â”€â”€ routes.ts            # DÃ©finition des routes
â”‚
â”œâ”€â”€ .env.local                   # Variables d'environnement (git-ignored)
â”œâ”€â”€ .env.example                 # Template variables d'environnement
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ postcss.config.js
â””â”€â”€ README.md
```

-----

## 5. STANDARDS DE CODE

### TypeScript

**Configuration tsconfig.json :**

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "@components/*": ["src/components/*"],
      "@pages/*": ["src/pages/*"],
      "@hooks/*": ["src/hooks/*"],
      "@services/*": ["src/services/*"],
      "@utils/*": ["src/utils/*"],
      "@types/*": ["src/types/*"]
    }
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

**RÃ¨gles de Nommage :**

```typescript
// Fichiers : PascalCase pour composants, camelCase pour utilitaires
// âœ… Correct
EventCard.tsx
useAuth.ts
date.utils.ts

// âŒ Incorrect
eventCard.tsx
UseAuth.ts
Date.Utils.ts

// Types : PascalCase + suffixe descriptif
type User = { ... }
interface EventData { ... }
enum EventStatus { ... }

// Variables : camelCase
const userName = "Alice";
let eventCount = 0;

// Constantes : UPPER_SNAKE_CASE
const API_URL = "https://api.events.app";
const MAX_PARTICIPANTS = 12;

// Fonctions : camelCase, verbes pour actions
function getUserById(id: string): User { ... }
function createEvent(data: EventData): Event { ... }

// Composants React : PascalCase
const EventCard: React.FC<EventCardProps> = ({ ... }) => { ... }

// Custom Hooks : camelCase + prÃ©fixe "use"
function useAuth() { ... }
function useRealtimeEvents(groupId: string) { ... }
```

**Types DÃ©finitions (Exemples) :**

```typescript
// src/types/event.types.ts
export type EventStatus = 
  | "idea" 
  | "voting" 
  | "pending_validation" 
  | "confirmed" 
  | "past" 
  | "cancelled";

export type VoteResponse = "yes" | "maybe" | "no";

export interface DateOption {
  optionId: string;
  start: Date;
  end: Date;
  proposedBy: string;
  votes: Vote[];
}

export interface Vote {
  userId: string;
  response: VoteResponse;
  votedAt: Date;
}

export interface Event {
  id: string;
  groupId: string;
  title: string;
  description: string;
  status: EventStatus;
  createdBy: string;
  organizerIds: string[];
  dateOptions: DateOption[];
  chosenDate?: {
    start: Date;
    end: Date;
    confirmedBy: string;
    confirmedAt: Date;
  };
  location?: {
    name: string;
    address: string;
    coordinates?: { lat: number; lng: number };
  };
  contributions?: Contribution[];
  expenses?: Expenses;
  createdAt: Date;
  updatedAt: Date;
}

export interface Contribution {
  contributionId: string;
  item: string;
  takenBy: string | null;
  quantity: number;
  addedAt: Date;
}

export interface Expenses {
  paymentLink?: string;
  totalAmount: number;
  whoPaid: string[];
}
```

### React Components

**Conventions :**

```typescript
// âœ… Functional Component avec TypeScript
import React from 'react';

interface EventCardProps {
  event: Event;
  onVote: (optionId: string, response: VoteResponse) => void;
  className?: string; // Toujours optionnel
}

export const EventCard: React.FC<EventCardProps> = ({ 
  event, 
  onVote,
  className = '' 
}) => {
  // Hooks en premier (ordre : useState, useEffect, useMemo, useCallback, custom hooks)
  const [isExpanded, setIsExpanded] = React.useState(false);
  
  React.useEffect(() => {
    // Side effects
  }, []);
  
  const handleVote = React.useCallback((optionId: string) => {
    onVote(optionId, 'yes');
  }, [onVote]);
  
  // Early returns
  if (!event) return null;
  
  // Render
  return (
    <div className={`event-card ${className}`}>
      {/* JSX */}
    </div>
  );
};

// Pas de default export sauf pour pages (lazy loading)
```

**Destructuring Props :**

```typescript
// âœ… Correct : Destructure dans les paramÃ¨tres
const Button: React.FC<ButtonProps> = ({ label, onClick, variant = 'primary' }) => {
  return <button onClick={onClick}>{label}</button>;
};

// âŒ Incorrect : Destructure dans le body
const Button: React.FC<ButtonProps> = (props) => {
  const { label, onClick, variant } = props;
  return <button onClick={onClick}>{label}</button>;
};
```

**Conditional Rendering :**

```typescript
// âœ… Correct : Ternaire pour JSX alternatif
{isLoading ? <Spinner /> : <Content />}

// âœ… Correct : && pour affichage conditionnel
{hasError && <ErrorMessage />}

// âŒ Incorrect : if/else dans JSX
{if (isLoading) { return <Spinner />; } else { return <Content />; }}
```

### Hooks PersonnalisÃ©s

```typescript
// src/hooks/useAuth.ts
import { useState, useEffect } from 'react';
import { onAuthStateChanged } from 'firebase/auth';
import { auth } from '@services/firebase';
import type { User } from '@types/user.types';

export function useAuth() {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<Error | null>(null);

  useEffect(() => {
    const unsubscribe = onAuthStateChanged(
      auth,
      (firebaseUser) => {
        if (firebaseUser) {
          // Map Firebase User to App User
          setUser({
            id: firebaseUser.uid,
            email: firebaseUser.email!,
            name: firebaseUser.displayName || '',
            photoURL: firebaseUser.photoURL || '',
          });
        } else {
          setUser(null);
        }
        setLoading(false);
      },
      (err) => {
        setError(err);
        setLoading(false);
      }
    );

    return () => unsubscribe();
  }, []);

  return { user, loading, error };
}
```

### Services

```typescript
// src/services/firestore.service.ts
import { 
  collection, 
  doc, 
  getDoc, 
  getDocs, 
  addDoc, 
  updateDoc, 
  deleteDoc,
  query,
  where,
  orderBy,
  Timestamp 
} from 'firebase/firestore';
import { db } from './firebase';
import type { Event, EventStatus } from '@types/event.types';

export class FirestoreService {
  // Collections refs
  private static readonly EVENTS = 'events';
  private static readonly GROUPS = 'groups';
  private static readonly USERS = 'users';

  // Create
  static async createEvent(eventData: Omit<Event, 'id'>): Promise<string> {
    try {
      const docRef = await addDoc(collection(db, this.EVENTS), {
        ...eventData,
        createdAt: Timestamp.now(),
        updatedAt: Timestamp.now(),
      });
      return docRef.id;
    } catch (error) {
      console.error('Error creating event:', error);
      throw new Error('Failed to create event');
    }
  }

  // Read
  static async getEventById(eventId: string): Promise<Event | null> {
    try {
      const docSnap = await getDoc(doc(db, this.EVENTS, eventId));
      if (!docSnap.exists()) return null;
      
      return {
        id: docSnap.id,
        ...docSnap.data(),
      } as Event;
    } catch (error) {
      console.error('Error fetching event:', error);
      throw new Error('Failed to fetch event');
    }
  }

  // Query
  static async getEventsByGroup(
    groupId: string, 
    status?: EventStatus
  ): Promise<Event[]> {
    try {
      let q = query(
        collection(db, this.EVENTS),
        where('groupId', '==', groupId),
        orderBy('createdAt', 'desc')
      );

      if (status) {
        q = query(q, where('status', '==', status));
      }

      const querySnapshot = await getDocs(q);
      return querySnapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data(),
      })) as Event[];
    } catch (error) {
      console.error('Error querying events:', error);
      throw new Error('Failed to query events');
    }
  }

  // Update
  static async updateEvent(
    eventId: string, 
    updates: Partial<Event>
  ): Promise<void> {
    try {
      await updateDoc(doc(db, this.EVENTS, eventId), {
        ...updates,
        updatedAt: Timestamp.now(),
      });
    } catch (error) {
      console.error('Error updating event:', error);
      throw new Error('Failed to update event');
    }
  }

  // Delete
  static async deleteEvent(eventId: string): Promise<void> {
    try {
      await deleteDoc(doc(db, this.EVENTS, eventId));
    } catch (error) {
      console.error('Error deleting event:', error);
      throw new Error('Failed to delete event');
    }
  }
}
```

### Utilitaires

```typescript
// src/utils/date.utils.ts
import { format, formatDistance, isAfter, isBefore, addDays } from 'date-fns';
import { fr } from 'date-fns/locale';

export class DateUtils {
  // Format date pour affichage
  static formatEventDate(date: Date): string {
    return format(date, 'EEEE d MMMM yyyy', { locale: fr });
  }

  // Format heure
  static formatEventTime(date: Date): string {
    return format(date, 'HH:mm', { locale: fr });
  }

  // Distance relative ("dans 2 jours")
  static getRelativeTime(date: Date): string {
    return formatDistance(date, new Date(), { 
      addSuffix: true, 
      locale: fr 
    });
  }

  // VÃ©rifier si Ã©vÃ©nement est urgent (<48h)
  static isEventUrgent(date: Date): boolean {
    const urgentThreshold = addDays(new Date(), 2);
    return isBefore(date, urgentThreshold) && isAfter(date, new Date());
  }

  // VÃ©rifier si Ã©vÃ©nement est passÃ©
  static isEventPast(date: Date): boolean {
    return isBefore(date, new Date());
  }
}
```

### Validation

```typescript
// src/utils/validation.utils.ts
export class ValidationUtils {
  // Email
  static isValidEmail(email: string): boolean {
    const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return regex.test(email);
  }

  // Titre Ã©vÃ©nement
  static isValidEventTitle(title: string): boolean {
    return title.trim().length >= 3 && title.trim().length <= 100;
  }

  // Date future
  static isFutureDate(date: Date): boolean {
    return date > new Date();
  }

  // Nombre participants
  static isValidParticipantCount(count: number): boolean {
    return count >= 2 && count <= 50; // Ajustable selon besoins
  }

  // Sanitize input (prÃ©vention XSS basique)
  static sanitizeInput(input: string): string {
    return input
      .trim()
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#x27;');
  }
}
```

### Constantes

```typescript
// src/utils/constants.ts
export const APP_CONFIG = {
  NAME: 'Event\'s',
  VERSION: '1.0.0',
  MIN_GROUP_SIZE: 4,
  MAX_GROUP_SIZE: 12,
  MIN_EVENT_TITLE_LENGTH: 3,
  MAX_EVENT_TITLE_LENGTH: 100,
  MIN_DATE_OPTIONS: 2,
  MAX_DATE_OPTIONS: 5,
  VOTE_DEADLINE_HOURS: 48,
  AUTO_VALIDATE_THRESHOLD: 0.8, // 80%
} as const;

export const EVENT_STATUS = {
  IDEA: 'idea',
  VOTING: 'voting',
  PENDING_VALIDATION: 'pending_validation',
  CONFIRMED: 'confirmed',
  PAST: 'past',
  CANCELLED: 'cancelled',
} as const;

export const VOTE_RESPONSE = {
  YES: 'yes',
  MAYBE: 'maybe',
  NO: 'no',
} as const;

export const ROUTES = {
  HOME: '/',
  DASHBOARD: '/dashboard',
  PROFILE: '/profile',
  GROUPS: '/groups',
  GROUP_DETAIL: '/groups/:groupId',
  EVENTS: '/events',
  EVENT_DETAIL: '/events/:eventId',
  LOGIN: '/login',
  REGISTER: '/register',
} as const;
```

-----
## 6. GESTION DES ERREURS

### Frontend

```typescript
// src/utils/error.utils.ts
export class AppError extends Error {
  constructor(
    message: string,
    public code: string,
    public statusCode: number = 500
  ) {
    super(message);
    this.name = 'AppError';
  }
}

export const ERROR_CODES = {
  // Auth
  AUTH_REQUIRED: 'AUTH_REQUIRED',
  INVALID_CREDENTIALS: 'INVALID_CREDENTIALS',
  EMAIL_ALREADY_EXISTS: 'EMAIL_ALREADY_EXISTS',
  
  // Firestore
  DOCUMENT_NOT_FOUND: 'DOCUMENT_NOT_FOUND',
  PERMISSION_DENIED: 'PERMISSION_DENIED',
  NETWORK_ERROR: 'NETWORK_ERROR',
  
  // Validation
  INVALID_INPUT: 'INVALID_INPUT',
  MISSING_REQUIRED_FIELD: 'MISSING_REQUIRED_FIELD',
  
  // Business Logic
  EVENT_ALREADY_CONFIRMED: 'EVENT_ALREADY_CONFIRMED',
  NOT_GROUP_MEMBER: 'NOT_GROUP_MEMBER',
  VOTE_DEADLINE_PASSED: 'VOTE_DEADLINE_PASSED',
} as const;

// Error Handler Hook
export function useErrorHandler() {
  const [error, setError] = useState<AppError | null>(null);

  const handleError = useCallback((err: unknown) => {
    if (err instanceof AppError) {
      setError(err);
    } else if (err instanceof Error) {
      setError(new AppError(err.message, 'UNKNOWN_ERROR'));
    } else {
      setError(new AppError('Une erreur inconnue est survenue', 'UNKNOWN_ERROR'));
    }
    
    // Log to Sentry in production
    if (import.meta.env.PROD) {
      console.error('[ERROR]', err);
      // Sentry.captureException(err);
    }
  }, []);

  const clearError = useCallback(() => setError(null), []);

  return { error, handleError, clearError };
}
```

### Cloud Functions

```typescript
// functions/src/utils/errors.ts
export class FunctionError extends Error {
  constructor(
    message: string,
    public code: string,
    public statusCode: number = 500
  ) {
    super(message);
    this.name = 'FunctionError';
  }
}

// Wrapper pour Cloud Functions
export function wrapFunction<T>(
  handler: (data: T, context: any) => Promise<any>
) {
  return async (data: T, context: any) => {
    try {
      return await handler(data, context);
    } catch (error) {
      console.error('Function error:', error);
      
      if (error instanceof FunctionError) {
        throw new functions.https.HttpsError(
          'internal',
          error.message,
          { code: error.code }
        );
      }
      
      throw new functions.https.HttpsError(
        'internal',
        'Une erreur interne est survenue'
      );
    }
  };
}
```

-----

## 7. CLOUD FUNCTIONS

### Structure

```
functions/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                 # Export des fonctions
â”‚   â”œâ”€â”€ triggers/                # Firestore triggers
â”‚   â”‚   â”œâ”€â”€ onEventCreated.ts
â”‚   â”‚   â”œâ”€â”€ onEventUpdated.ts
â”‚   â”‚   â””â”€â”€ onVoteSubmitted.ts
â”‚   â”œâ”€â”€ callable/                # Fonctions HTTP callable
â”‚   â”‚   â”œâ”€â”€ validateEvent.ts
â”‚   â”‚   â”œâ”€â”€ sendInvitation.ts
â”‚   â”‚   â””â”€â”€ generateAISummary.ts
â”‚   â”œâ”€â”€ scheduled/               # Fonctions planifiÃ©es (cron)
â”‚   â”‚   â”œâ”€â”€ checkEventDeadlines.ts
â”‚   â”‚   â””â”€â”€ cleanupPastEvents.ts
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ admin.ts             # Firebase Admin setup
â”‚       â”œâ”€â”€ notifications.ts
â”‚       â””â”€â”€ ai.ts
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

### Exemples de Fonctions

```typescript
// functions/src/triggers/onEventCreated.ts
import * as functions from 'firebase-functions';
import { getFirestore } from 'firebase-admin/firestore';
import { sendNotificationToGroup } from '../utils/notifications';

export const onEventCreated = functions.firestore
  .document('events/{eventId}')
  .onCreate(async (snap, context) => {
    const event = snap.data();
    const eventId = context.params.eventId;
    
    // RÃ©cupÃ©rer les membres du groupe
    const db = getFirestore();
    const groupDoc = await db.collection('groups').doc(event.groupId).get();
    
    if (!groupDoc.exists) {
      console.error('Group not found:', event.groupId);
      return;
    }
    
    const group = groupDoc.data();
    const memberIds = group?.members.map((m: any) => m.userId) || [];
    
    // Envoyer notification Ã  tous les membres
    await sendNotificationToGroup(
      memberIds,
      {
        title: `Nouvel Ã©vÃ©nement : ${event.title}`,
        body: `${event.createdBy} a crÃ©Ã© un Ã©vÃ©nement dans ${group.name}`,
        data: {
          type: 'new_event',
          eventId,
          groupId: event.groupId,
        }
      }
    );
    
    console.log(`Notifications sent for event ${eventId}`);
  });
```

```typescript
// functions/src/triggers/onVoteSubmitted.ts
import * as functions from 'firebase-functions';
import { getFirestore } from 'firebase-admin/firestore';

export const onVoteSubmitted = functions.firestore
  .document('events/{eventId}')
  .onUpdate(async (change, context) => {
    const before = change.before.data();
    const after = change.after.data();
    const eventId = context.params.eventId;
    
    // VÃ©rifier si c'est un nouveau vote
    const voteCountBefore = before.dateOptions?.reduce(
      (acc: number, opt: any) => acc + (opt.votes?.length || 0),
      0
    ) || 0;
    
    const voteCountAfter = after.dateOptions?.reduce(
      (acc: number, opt: any) => acc + (opt.votes?.length || 0),
      0
    ) || 0;
    
    if (voteCountAfter <= voteCountBefore) return;
    
    // VÃ©rifier si on atteint le seuil de validation auto
    const db = getFirestore();
    const groupDoc = await db.collection('groups').doc(after.groupId).get();
    const totalMembers = groupDoc.data()?.members.length || 0;
    
    for (const option of after.dateOptions) {
      const yesVotes = option.votes?.filter((v: any) => v.response === 'yes').length || 0;
      const threshold = totalMembers * 0.8; // 80%
      
      if (yesVotes >= threshold && after.status === 'voting') {
        // Auto-validation
        await change.after.ref.update({
          status: 'confirmed',
          chosenDate: {
            start: option.start,
            end: option.end,
            confirmedBy: 'system',
            confirmedAt: new Date(),
          },
        });
        
        console.log(`Event ${eventId} auto-validated`);
        break;
      }
    }
  });
```

```typescript
// functions/src/callable/generateAISummary.ts
import * as functions from 'firebase-functions';
import { getFirestore } from 'firebase-admin/firestore';
import { generateSummary } from '../utils/ai';

interface SummaryRequest {
  eventId: string;
}

export const generateAISummary = functions.https.onCall(
  async (data: SummaryRequest, context) => {
    // VÃ©rifier auth
    if (!context.auth) {
      throw new functions.https.HttpsError(
        'unauthenticated',
        'User must be authenticated'
      );
    }
    
    const { eventId } = data;
    const db = getFirestore();
    
    // RÃ©cupÃ©rer l'Ã©vÃ©nement
    const eventDoc = await db.collection('events').doc(eventId).get();
    if (!eventDoc.exists) {
      throw new functions.https.HttpsError(
        'not-found',
        'Event not found'
      );
    }
    
    // RÃ©cupÃ©rer les messages
    const messagesSnap = await db
      .collection('events')
      .doc(eventId)
      .collection('messages')
      .orderBy('timestamp', 'asc')
      .limit(50)
      .get();
    
    const messages = messagesSnap.docs.map(doc => ({
      sender: doc.data().senderId,
      text: doc.data().text,
    }));
    
    // GÃ©nÃ©rer rÃ©sumÃ© avec IA
    const summary = await generateSummary(messages);
    
    return { summary };
  }
);
```

```typescript
// functions/src/scheduled/checkEventDeadlines.ts
import * as functions from 'firebase-functions';
import { getFirestore } from 'firebase-admin/firestore';
import { sendNotification } from '../utils/notifications';

// ExÃ©cuter toutes les heures
export const checkEventDeadlines = functions.pubsub
  .schedule('every 1 hours')
  .onRun(async (context) => {
    const db = getFirestore();
    const now = new Date();
    const in48Hours = new Date(now.getTime() + 48 * 60 * 60 * 1000);
    
    // Trouver Ã©vÃ©nements en vote avec deadline proche
    const eventsSnap = await db
      .collection('events')
      .where('status', '==', 'voting')
      .get();
    
    for (const eventDoc of eventsSnap.docs) {
      const event = eventDoc.data();
      const earliestDate = event.dateOptions
        .map((opt: any) => opt.start.toDate())
        .sort((a: Date, b: Date) => a.getTime() - b.getTime())[0];
      
      if (earliestDate && earliestDate <= in48Hours) {
        // Envoyer rappel aux membres qui n'ont pas votÃ©
        const groupDoc = await db.collection('groups').doc(event.groupId).get();
        const allMembers = groupDoc.data()?.members.map((m: any) => m.userId) || [];
        
        const votedMembers = new Set(
          event.dateOptions.flatMap((opt: any) => 
            opt.votes?.map((v: any) => v.userId) || []
          )
        );
        
        const nonVoters = allMembers.filter((id: string) => !votedMembers.has(id));
        
        for (const userId of nonVoters) {
          await sendNotification(userId, {
            title: 'Rappel : Vote requis',
            body: `Il reste moins de 48h pour voter sur "${event.title}"`,
            data: {
              type: 'vote_reminder',
              eventId: eventDoc.id,
            }
          });
        }
        
        console.log(`Reminders sent for event ${eventDoc.id}`);
      }
    }
    
    return null;
  });
```

### Utilitaires Cloud Functions

```typescript
// functions/src/utils/notifications.ts
import { getMessaging } from 'firebase-admin/messaging';
import { getFirestore } from 'firebase-admin/firestore';

interface NotificationPayload {
  title: string;
  body: string;
  data?: Record<string, string>;
}

export async function sendNotification(
  userId: string,
  payload: NotificationPayload
): Promise<void> {
  const db = getFirestore();
  const userDoc = await db.collection('users').doc(userId).get();
  
  if (!userDoc.exists) {
    console.warn('User not found:', userId);
    return;
  }
  
  const fcmToken = userDoc.data()?.fcmToken;
  if (!fcmToken) {
    console.warn('No FCM token for user:', userId);
    return;
  }
  
  try {
    await getMessaging().send({
      token: fcmToken,
      notification: {
        title: payload.title,
        body: payload.body,
      },
      data: payload.data || {},
      webpush: {
        fcmOptions: {
          link: payload.data?.actionURL || '/',
        }
      }
    });
    
    // Enregistrer notification dans Firestore
    await db.collection('notifications').doc(userId).collection('items').add({
      ...payload,
      read: false,
      createdAt: new Date(),
    });
    
  } catch (error) {
    console.error('Error sending notification:', error);
  }
}

export async function sendNotificationToGroup(
  memberIds: string[],
  payload: NotificationPayload
): Promise<void> {
  await Promise.all(
    memberIds.map(userId => sendNotification(userId, payload))
  );
}
```

```typescript
// functions/src/utils/ai.ts
import { GoogleGenerativeAI } from '@google/generative-ai';

const genAI = new GoogleGenerativeAI(process.env.GOOGLE_AI_API_KEY!);

interface Message {
  sender: string;
  text: string;
}

export async function generateSummary(messages: Message[]): Promise<string> {
  const model = genAI.getGenerativeModel({ model: 'gemini-pro' });
  
  const prompt = `
Tu es un assistant pour une application d'organisation d'Ã©vÃ©nements entre amis.
Analyse cette conversation et extrais :
1. Les dÃ©cisions prises (date, lieu, horaire)
2. Les informations pratiques importantes
3. Qui apporte quoi

Messages :
${messages.map(m => `- ${m.text}`).join('\n')}

RÃ©ponds de maniÃ¨re concise et structurÃ©e.
`;

  const result = await model.generateContent(prompt);
  const response = await result.response;
  return response.text();
}

export async function detectConflicts(
  userId: string,
  proposedDate: Date
): Promise<string[]> {
  // RÃ©cupÃ©rer autres Ã©vÃ©nements de l'utilisateur
  const db = getFirestore();
  const eventsSnap = await db
    .collection('events')
    .where('status', '==', 'confirmed')
    .get();
  
  const conflicts: string[] = [];
  
  for (const doc of eventsSnap.docs) {
    const event = doc.data();
    const eventDate = event.chosenDate?.start.toDate();
    
    if (eventDate && 
        Math.abs(eventDate.getTime() - proposedDate.getTime()) < 3 * 60 * 60 * 1000) {
      conflicts.push(event.title);
    }
  }
  
  return conflicts;
}
```

-----

## 8. TESTS

### Configuration Jest

```javascript
// jest.config.js
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'jsdom',
  roots: ['<rootDir>/src'],
  testMatch: ['**/__tests__/**/*.ts?(x)', '**/?(*.)+(spec|test).ts?(x)'],
  moduleNameMapper: {
    '^@/(.*)$': '<rootDir>/src/$1',
    '^@components/(.*)$': '<rootDir>/src/components/$1',
    '^@hooks/(.*)$': '<rootDir>/src/hooks/$1',
    '^@services/(.*)$': '<rootDir>/src/services/$1',
    '^@utils/(.*)$': '<rootDir>/src/utils/$1',
    '\\.(css|less|scss|sass)$': 'identity-obj-proxy',
  },
  setupFilesAfterEnv: ['<rootDir>/src/setupTests.ts'],
  collectCoverageFrom: [
    'src/**/*.{ts,tsx}',
    '!src/**/*.d.ts',
    '!src/main.tsx',
    '!src/**/*.stories.tsx',
  ],
  coverageThreshold: {
    global: {
      branches: 70,
      functions: 70,
      lines: 70,
      statements: 70,
    },
  },
};
```

### Tests Unitaires

```typescript
// src/utils/__tests__/date.utils.test.ts
import { DateUtils } from '../date.utils';

describe('DateUtils', () => {
  describe('formatEventDate', () => {
    it('should format date correctly in French', () => {
      const date = new Date('2024-12-25');
      const result = DateUtils.formatEventDate(date);
      expect(result).toMatch(/dÃ©cembre 2024/);
    });
  });

  describe('isEventUrgent', () => {
    it('should return true for events within 48 hours', () => {
      const urgentDate = new Date(Date.now() + 24 * 60 * 60 * 1000);
      expect(DateUtils.isEventUrgent(urgentDate)).toBe(true);
    });

    it('should return false for events beyond 48 hours', () => {
      const futureDate = new Date(Date.now() + 72 * 60 * 60 * 1000);
      expect(DateUtils.isEventUrgent(futureDate)).toBe(false);
    });

    it('should return false for past events', () => {
      const pastDate = new Date(Date.now() - 24 * 60 * 60 * 1000);
      expect(DateUtils.isEventUrgent(pastDate)).toBe(false);
    });
  });
});
```

```typescript
// src/components/__tests__/Button.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { Button } from '../common/Button';

describe('Button', () => {
  it('should render with label', () => {
    render(<Button label="Click me" onClick={() => {}} />);
    expect(screen.getByText('Click me')).toBeInTheDocument();
  });

  it('should call onClick when clicked', () => {
    const handleClick = jest.fn();
    render(<Button label="Click me" onClick={handleClick} />);
    
    fireEvent.click(screen.getByText('Click me'));
    expect(handleClick).toHaveBeenCalledTimes(1);
  });

  it('should be disabled when disabled prop is true', () => {
    render(<Button label="Click me" onClick={() => {}} disabled />);
    expect(screen.getByText('Click me')).toBeDisabled();
  });

  it('should apply variant class', () => {
    const { container } = render(
      <Button label="Click me" onClick={() => {}} variant="secondary" />
    );
    expect(container.firstChild).toHaveClass('btn-secondary');
  });
});
```

### Tests d'IntÃ©gration

```typescript
// src/services/__tests__/firestore.service.test.ts
import { FirestoreService } from '../firestore.service';
import { initializeTestEnvironment } from '@firebase/rules-unit-testing';

describe('FirestoreService', () => {
  let testEnv: any;

  beforeAll(async () => {
    testEnv = await initializeTestEnvironment({
      projectId: 'test-project',
      firestore: {
        rules: `
          rules_version = '2';
          service cloud.firestore {
            match /databases/{database}/documents {
              match /{document=**} {
                allow read, write: if true;
              }
            }
          }
        `,
      },
    });
  });

  afterAll(async () => {
    await testEnv.cleanup();
  });

  it('should create an event', async () => {
    const eventData = {
      groupId: 'group1',
      title: 'Test Event',
      description: 'Test Description',
      status: 'idea' as const,
      createdBy: 'user1',
      organizerIds: ['user1'],
      dateOptions: [],
      createdAt: new Date(),
      updatedAt: new Date(),
    };

    const eventId = await FirestoreService.createEvent(eventData);
    expect(eventId).toBeDefined();
    expect(typeof eventId).toBe('string');
  });
});
```

-----

## 9. PERFORMANCE & OPTIMISATION

### Code Splitting

```typescript
// src/App.tsx
import { lazy, Suspense } from 'react';
import { BrowserRouter, Routes, Route } from 'react-router-dom';
import { LoadingSpinner } from '@components/common/LoadingSpinner';

// Lazy loading des pages
const Dashboard = lazy(() => import('@pages/Dashboard'));
const GroupDetail = lazy(() => import('@pages/GroupDetail'));
const EventDetail = lazy(() => import('@pages/EventDetail'));
const Profile = lazy(() => import('@pages/Profile'));

export function App() {
  return (
    <BrowserRouter>
      <Suspense fallback={<LoadingSpinner />}>
        <Routes>
          <Route path="/" element={<Dashboard />} />
          <Route path="/groups/:groupId" element={<GroupDetail />} />
          <Route path="/events/:eventId" element={<EventDetail />} />
          <Route path="/profile" element={<Profile />} />
        </Routes>
      </Suspense>
    </BrowserRouter>
  );
}
```

### Memoization

```typescript
// src/components/EventCard.tsx
import { memo, useMemo } from 'react';

interface EventCardProps {
  event: Event;
  onVote: (optionId: string, response: VoteResponse) => void;
}

export const EventCard = memo<EventCardProps>(({ event, onVote }) => {
  // Calcul coÃ»teux mis en cache
  const voteStats = useMemo(() => {
    return event.dateOptions.map(option => ({
      optionId: option.optionId,
      yesCount: option.votes.filter(v => v.response === 'yes').length,
      maybeCount: option.votes.filter(v => v.response === 'maybe').length,
      noCount: option.votes.filter(v => v.response === 'no').length,
    }));
  }, [event.dateOptions]);

  return (
    <div className="event-card">
      {/* Render */}
    </div>
  );
}, (prevProps, nextProps) => {
  // Custom comparison pour Ã©viter re-renders inutiles
  return prevProps.event.id === nextProps.event.id &&
         prevProps.event.updatedAt === nextProps.event.updatedAt;
});
```

### Image Optimization

```typescript
// src/components/common/Avatar.tsx
interface AvatarProps {
  src: string;
  alt: string;
  size?: 'sm' | 'md' | 'lg';
}

export const Avatar: React.FC<AvatarProps> = ({ src, alt, size = 'md' }) => {
  const sizeMap = {
    sm: 32,
    md: 40,
    lg: 80,
  };

  const dimension = sizeMap[size];

  // Optimisation image avec Firebase Storage
  const optimizedSrc = src.includes('firebasestorage.googleapis.com')
    ? `${src}?alt=media&w=${dimension}&h=${dimension}&fit=crop`
    : src;

  return (
    <img
      src={optimizedSrc}
      alt={alt}
      width={dimension}
      height={dimension}
      loading="lazy"
      className="avatar"
    />
  );
};
```

### Firestore Query Optimization

```typescript
// âŒ Mauvais : Fetch tous les Ã©vÃ©nements puis filtre en JS
const allEvents = await FirestoreService.getAllEvents();
const confirmedEvents = allEvents.filter(e => e.status === 'confirmed');

// âœ… Bon : Filtre cÃ´tÃ© serveur
const confirmedEvents = await FirestoreService.getEventsByStatus('confirmed');

// âŒ Mauvais : Lecture dans boucle (N+1)
for (const userId of userIds) {
  const user = await FirestoreService.getUserById(userId);
  users.push(user);
}

// âœ… Bon : Batch read
const users = await FirestoreService.getUsersByIds(userIds);
```

### Debounce & Throttle

```typescript
// src/hooks/useDebounce.ts
import { useEffect, useState } from 'react';

export function useDebounce<T>(value: T, delay: number): T {
  const [debouncedValue, setDebouncedValue] = useState<T>(value);

  useEffect(() => {
    const handler = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    return () => {
      clearTimeout(handler);
    };
  }, [value, delay]);

  return debouncedValue;
}

// Utilisation dans search
function SearchBar() {
  const [query, setQuery] = useState('');
  const debouncedQuery = useDebounce(query, 500);

  useEffect(() => {
    if (debouncedQuery) {
      // Effectuer recherche
      searchEvents(debouncedQuery);
    }
  }, [debouncedQuery]);

  return <input value={query} onChange={e => setQuery(e.target.value)} />;
}
```

-----

## 10. SÃ‰CURITÃ‰

### Variables d'Environnement

```bash
# .env.example
VITE_FIREBASE_API_KEY=your_api_key
VITE_FIREBASE_AUTH_DOMAIN=your_auth_domain
VITE_FIREBASE_PROJECT_ID=your_project_id
VITE_FIREBASE_STORAGE_BUCKET=your_storage_bucket
VITE_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
VITE_FIREBASE_APP_ID=your_app_id
VITE_GOOGLE_AI_API_KEY=your_ai_api_key

# Ne jamais commiter .env.local
```

```typescript
// src/config/env.ts
const requiredEnvVars = [
  'VITE_FIREBASE_API_KEY',
  'VITE_FIREBASE_AUTH_DOMAIN',
  'VITE_FIREBASE_PROJECT_ID',
] as const;

// Validation au dÃ©marrage
for (const varName of requiredEnvVars) {
  if (!import.meta.env[varName]) {
    throw new Error(`Missing required environment variable: ${varName}`);
  }
}

export const env = {
  firebase: {
    apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
    authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
    projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
    storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
    messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
    appId: import.meta.env.VITE_FIREBASE_APP_ID,
  },
  googleAI: {
    apiKey: import.meta.env.VITE_GOOGLE_AI_API_KEY,
  },
} as const;
```

### Input Sanitization

```typescript
// Toujours valider et sanitizer les inputs utilisateur
function createEvent(data: any) {
  const sanitized = {
    title: ValidationUtils.sanitizeInput(data.title),
    description: ValidationUtils.sanitizeInput(data.description),
    // ...
  };

  if (!ValidationUtils.isValidEventTitle(sanitized.title)) {
    throw new AppError('Invalid title', ERROR_CODES.INVALID_INPUT);
  }

  return FirestoreService.createEvent(sanitized);
}
```

### CORS Configuration (Cloud Functions)

```typescript
// functions/src/index.ts
import * as functions from 'firebase-functions';
import * as cors from 'cors';

const corsHandler = cors({
  origin: [
    'https://events-app.web.app',
    'https://events-app.firebaseapp.com',
    ...(process.env.NODE_ENV === 'development' ? ['http://localhost:5173'] : []),
  ],
  credentials: true,
});

export const myFunction = functions.https.onRequest((req, res) => {
  return corsHandler(req, res, async () => {
    // Function logic
  });
});
```

-----

## 11. CI/CD & DÃ‰PLOIEMENT

### Pipeline GitHub Actions

**Workflow principal de dÃ©ploiement :**

```yaml
# .github/workflows/deploy.yml
name: Deploy to Firebase

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  NODE_VERSION: '20'

jobs:
  test:
    name: Run Tests
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Run linter
        run: npm run lint
      
      - name: Run type check
        run: npm run type-check
      
      - name: Run unit tests
        run: npm run test:unit
      
      - name: Run integration tests
        run: npm run test:integration
      
      - name: Generate coverage report
        run: npm run test:coverage
      
      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v3
        with:
          token: ${{ secrets.CODECOV_TOKEN }}
          files: ./coverage/coverage-final.json
          fail_ci_if_error: true

  build:
    name: Build Application
    runs-on: ubuntu-latest
    needs: test
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build application
        run: npm run build
        env:
          VITE_FIREBASE_API_KEY: ${{ secrets.VITE_FIREBASE_API_KEY }}
          VITE_FIREBASE_AUTH_DOMAIN: ${{ secrets.VITE_FIREBASE_AUTH_DOMAIN }}
          VITE_FIREBASE_PROJECT_ID: ${{ secrets.VITE_FIREBASE_PROJECT_ID }}
          VITE_FIREBASE_STORAGE_BUCKET: ${{ secrets.VITE_FIREBASE_STORAGE_BUCKET }}
          VITE_FIREBASE_MESSAGING_SENDER_ID: ${{ secrets.VITE_FIREBASE_MESSAGING_SENDER_ID }}
          VITE_FIREBASE_APP_ID: ${{ secrets.VITE_FIREBASE_APP_ID }}
          VITE_GOOGLE_AI_API_KEY: ${{ secrets.VITE_GOOGLE_AI_API_KEY }}
      
      - name: Run Lighthouse CI
        run: |
          npm install -g @lhci/cli
          lhci autorun
        env:
          LHCI_GITHUB_APP_TOKEN: ${{ secrets.LHCI_GITHUB_APP_TOKEN }}
      
      - name: Archive build artifacts
        uses: actions/upload-artifact@v3
        with:
          name: dist
          path: dist/
          retention-days: 7

  deploy-preview:
    name: Deploy Preview
    runs-on: ubuntu-latest
    needs: build
    if: github.event_name == 'pull_request'
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Download build artifacts
        uses: actions/download-artifact@v3
        with:
          name: dist
          path: dist/
      
      - name: Deploy to Firebase Hosting (Preview)
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: ${{ secrets.GITHUB_TOKEN }}
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}
          projectId: ${{ secrets.FIREBASE_PROJECT_ID }}
          expires: 7d
        env:
          FIREBASE_CLI_PREVIEWS: hostingchannels

  deploy-production:
    name: Deploy to Production
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Download build artifacts
        uses: actions/download-artifact@v3
        with:
          name: dist
          path: dist/
      
      - name: Deploy to Firebase Hosting (Production)
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: ${{ secrets.GITHUB_TOKEN }}
          firebaseServiceAccount: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}
          projectId: ${{ secrets.FIREBASE_PROJECT_ID }}
          channelId: live
      
      - name: Deploy Cloud Functions
        run: |
          cd functions
          npm ci
          npm run deploy
        env:
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
      
      - name: Notify deployment success
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          text: 'Production deployment successful! ğŸš€'
          webhook_url: ${{ secrets.SLACK_WEBHOOK }}
        if: success()
      
      - name: Notify deployment failure
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          text: 'Production deployment failed! âš ï¸'
          webhook_url: ${{ secrets.SLACK_WEBHOOK }}
        if: failure()

  deploy-firestore-rules:
    name: Deploy Firestore Rules
    runs-on: ubuntu-latest
    needs: test
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Deploy Firestore Security Rules
        run: |
          npm install -g firebase-tools
          firebase deploy --only firestore:rules
        env:
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
      
      - name: Deploy Firestore Indexes
        run: firebase deploy --only firestore:indexes
        env:
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
```

### Workflow pour Cloud Functions

```yaml
# .github/workflows/functions.yml
name: Deploy Cloud Functions

on:
  push:
    branches: [main]
    paths:
      - 'functions/**'
  pull_request:
    branches: [main]
    paths:
      - 'functions/**'

jobs:
  test-functions:
    name: Test Cloud Functions
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: functions/package-lock.json
      
      - name: Install dependencies
        working-directory: functions
        run: npm ci
      
      - name: Run linter
        working-directory: functions
        run: npm run lint
      
      - name: Run tests
        working-directory: functions
        run: npm run test
      
      - name: Build functions
        working-directory: functions
        run: npm run build

  deploy-functions:
    name: Deploy Functions to Production
    runs-on: ubuntu-latest
    needs: test-functions
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
      
      - name: Install Firebase CLI
        run: npm install -g firebase-tools
      
      - name: Deploy Cloud Functions
        working-directory: functions
        run: |
          npm ci
          npm run build
          firebase deploy --only functions
        env:
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
```

### Configuration Lighthouse CI

```javascript
// lighthouserc.js
module.exports = {
  ci: {
    collect: {
      startServerCommand: 'npm run preview',
      url: ['http://localhost:4173'],
      numberOfRuns: 3,
      settings: {
        preset: 'desktop',
      },
    },
    assert: {
      assertions: {
        'categories:performance': ['error', { minScore: 0.9 }],
        'categories:accessibility': ['error', { minScore: 0.9 }],
        'categories:best-practices': ['error', { minScore: 0.9 }],
        'categories:seo': ['error', { minScore: 0.9 }],
        'categories:pwa': ['warn', { minScore: 0.8 }],
      },
    },
    upload: {
      target: 'temporary-public-storage',
    },
  },
};
```

### Scripts Package.json (Complet)

```json
{
  "name": "events-app",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "lint:fix": "eslint . --ext ts,tsx --fix",
    "type-check": "tsc --noEmit",
    "test": "jest",
    "test:unit": "jest --testPathPattern=unit",
    "test:integration": "jest --testPathPattern=integration",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "format": "prettier --write \"src/**/*.{ts,tsx,css}\"",
    "format:check": "prettier --check \"src/**/*.{ts,tsx,css}\"",
    "deploy:preview": "firebase hosting:channel:deploy preview",
    "deploy:prod": "firebase deploy --only hosting",
    "emulators": "firebase emulators:start",
    "functions:deploy": "cd functions && npm run deploy",
    "firestore:rules": "firebase deploy --only firestore:rules",
    "firestore:indexes": "firebase deploy --only firestore:indexes"
  }
}
```

### Configuration Firebase Hosting

```json
// firebase.json
{
  "hosting": {
    "public": "dist",
    "ignore": [
      "firebase.json",
      "**/.*",
      "**/node_modules/**"
    ],
    "rewrites": [
      {
        "source": "**",
        "destination": "/index.html"
      }
    ],
    "headers": [
      {
        "source": "**/*.@(jpg|jpeg|gif|png|svg|webp)",
        "headers": [
          {
            "key": "Cache-Control",
            "value": "max-age=31536000"
          }
        ]
      },
      {
        "source": "**/*.@(js|css)",
        "headers": [
          {
            "key": "Cache-Control",
            "value": "max-age=31536000"
          }
        ]
      },
      {
        "source": "index.html",
        "headers": [
          {
            "key": "Cache-Control",
            "value": "no-cache, no-store, must-revalidate"
          }
        ]
      },
      {
        "source": "**",
        "headers": [
          {
            "key": "X-Content-Type-Options",
            "value": "nosniff"
          },
          {
            "key": "X-Frame-Options",
            "value": "DENY"
          },
          {
            "key": "X-XSS-Protection",
            "value": "1; mode=block"
          },
          {
            "key": "Referrer-Policy",
            "value": "strict-origin-when-cross-origin"
          }
        ]
      }
    ]
  },
  "firestore": {
    "rules": "firestore.rules",
    "indexes": "firestore.indexes.json"
  },
  "functions": [
    {
      "source": "functions",
      "codebase": "default",
      "ignore": [
        "node_modules",
        ".git",
        "firebase-debug.log",
        "firebase-debug.*.log"
      ]
    }
  ],
  "emulators": {
    "auth": {
      "port": 9099
    },
    "functions": {
      "port": 5001
    },
    "firestore": {
      "port": 8080
    },
    "hosting": {
      "port": 5000
    },
    "ui": {
      "enabled": true,
      "port": 4000
    },
    "singleProjectMode": true
  }
}
```

### Environnements & Configuration

```bash
# .env.development
VITE_FIREBASE_API_KEY=dev_api_key
VITE_FIREBASE_AUTH_DOMAIN=events-dev.firebaseapp.com
VITE_FIREBASE_PROJECT_ID=events-dev
VITE_FIREBASE_STORAGE_BUCKET=events-dev.appspot.com
VITE_FIREBASE_MESSAGING_SENDER_ID=123456789
VITE_FIREBASE_APP_ID=dev_app_id
VITE_GOOGLE_AI_API_KEY=dev_ai_key
VITE_ENV=development

# .env.production
VITE_FIREBASE_API_KEY=prod_api_key
VITE_FIREBASE_AUTH_DOMAIN=events-app.web.app
VITE_FIREBASE_PROJECT_ID=events-prod
VITE_FIREBASE_STORAGE_BUCKET=events-prod.appspot.com
VITE_FIREBASE_MESSAGING_SENDER_ID=987654321
VITE_FIREBASE_APP_ID=prod_app_id
VITE_GOOGLE_AI_API_KEY=prod_ai_key
VITE_ENV=production
```

### Monitoring & Alertes

**Configuration Firebase Performance Monitoring :**

```typescript
// src/services/monitoring.service.ts
import { getPerformance, trace } from 'firebase/performance';
import { app } from './firebase';

const perf = getPerformance(app);

export class MonitoringService {
  // Tracer une opÃ©ration
  static async traceOperation<T>(
    name: string,
    operation: () => Promise<T>
  ): Promise<T> {
    const t = trace(perf, name);
    t.start();
    
    try {
      const result = await operation();
      t.stop();
      return result;
    } catch (error) {
      t.stop();
      throw error;
    }
  }

  // Tracer chargement composant
  static traceComponent(componentName: string) {
    const t = trace(perf, `component_${componentName}`);
    t.start();
    
    return () => t.stop();
  }

  // MÃ©triques personnalisÃ©es
  static recordMetric(name: string, value: number) {
    const t = trace(perf, name);
    t.putMetric(name, value);
  }

  // Log erreur vers Sentry
  static logError(error: Error, context?: Record<string, any>) {
    if (import.meta.env.PROD) {
      // Sentry.captureException(error, { extra: context });
      console.error('[MONITORING]', error, context);
    } else {
      console.error('[DEV ERROR]', error, context);
    }
  }

  // Log analytics event
  static logAnalyticsEvent(
    eventName: string, 
    params?: Record<string, any>
  ) {
    // Firebase Analytics
    // logEvent(analytics, eventName, params);
    console.log('[ANALYTICS]', eventName, params);
  }
}

// Hook React pour tracer le render
export function usePerformanceTrace(componentName: string) {
  React.useEffect(() => {
    const stopTrace = MonitoringService.traceComponent(componentName);
    return stopTrace;
  }, [componentName]);
}
```

**IntÃ©gration Sentry :**

```typescript
// src/config/sentry.ts
import * as Sentry from '@sentry/react';
import { BrowserTracing } from '@sentry/tracing';

if (import.meta.env.PROD) {
  Sentry.init({
    dsn: import.meta.env.VITE_SENTRY_DSN,
    integrations: [
      new BrowserTracing(),
      new Sentry.Replay({
        maskAllText: true,
        blockAllMedia: true,
      }),
    ],
    tracesSampleRate: 0.1, // 10% des transactions
    replaysSessionSampleRate: 0.1,
    replaysOnErrorSampleRate: 1.0,
    environment: import.meta.env.VITE_ENV,
    beforeSend(event, hint) {
      // Filtrer les erreurs non critiques
      if (event.exception) {
        const error = hint.originalException;
        if (error instanceof Error && error.message.includes('ResizeObserver')) {
          return null; // Ignore ResizeObserver errors
        }
      }
      return event;
    },
  });
}
```

### Health Checks & Status Page

```typescript
// functions/src/callable/healthCheck.ts
import * as functions from 'firebase-functions';
import { getFirestore } from 'firebase-admin/firestore';

export const healthCheck = functions.https.onRequest(async (req, res) => {
  const checks = {
    timestamp: new Date().toISOString(),
    status: 'healthy',
    services: {} as Record<string, string>,
  };

  try {
    // VÃ©rifier Firestore
    const db = getFirestore();
    await db.collection('_health').doc('check').set({
      lastCheck: new Date(),
    });
    checks.services.firestore = 'ok';
  } catch (error) {
    checks.services.firestore = 'error';
    checks.status = 'degraded';
  }

  // VÃ©rifier Auth (optionnel)
  try {
    // Minimal check
    checks.services.auth = 'ok';
  } catch (error) {
    checks.services.auth = 'error';
    checks.status = 'degraded';
  }

  const statusCode = checks.status === 'healthy' ? 200 : 503;
  res.status(statusCode).json(checks);
});
```

### Rollback Strategy

**Script de rollback :**

```bash
#!/bin/bash
# scripts/rollback.sh

echo "ğŸ”„ Starting rollback procedure..."

# RÃ©cupÃ©rer le dernier dÃ©ploiement rÃ©ussi
LAST_VERSION=$(firebase hosting:clone events-prod:live events-prod:rollback)

echo "ğŸ“¦ Rolling back to version: $LAST_VERSION"

# DÃ©ployer la version prÃ©cÃ©dente
firebase hosting:channel:deploy live --only hosting

echo "âœ… Rollback completed"

# Notification Slack
curl -X POST $SLACK_WEBHOOK_URL \
  -H 'Content-Type: application/json' \
  -d '{
    "text": "âš ï¸ Production rollback executed",
    "attachments": [{
      "color": "warning",
      "text": "Rolled back to previous stable version"
    }]
  }'
```

### StratÃ©gie de DÃ©ploiement

**Blue-Green Deployment avec Firebase Hosting Channels :**

```bash
# DÃ©ployer sur canal preview
firebase hosting:channel:deploy preview --expires 7d

# Tester la preview
# Si OK, promouvoir en production
firebase hosting:clone events-prod:preview events-prod:live

# Si problÃ¨me, supprimer le canal
firebase hosting:channel:delete preview
```

### Backup & Disaster Recovery

```typescript
// functions/src/scheduled/backupFirestore.ts
import * as functions from 'firebase-functions';
import { getFirestore } from 'firebase-admin/firestore';
import { Storage } from '@google-cloud/storage';

// ExÃ©cuter tous les jours Ã  2h du matin
export const backupFirestore = functions.pubsub
  .schedule('0 2 * * *')
  .timeZone('Europe/Paris')
  .onRun(async (context) => {
    const projectId = process.env.GCLOUD_PROJECT;
    const databaseName = '(default)';
    const bucket = `gs://${projectId}-backups`;
    
    const client = new Firestore.v1.FirestoreAdminClient();
    
    const timestamp = new Date().toISOString().split('T')[0];
    const outputUriPrefix = `${bucket}/${timestamp}`;
    
    try {
      const [operation] = await client.exportDocuments({
        name: `projects/${projectId}/databases/${databaseName}`,
        outputUriPrefix,
        collectionIds: [], // Empty = all collections
      });
      
      console.log(`Backup started: ${operation.name}`);
      await operation.promise();
      console.log('Backup completed successfully');
      
      // Nettoyer les backups > 30 jours
      await cleanupOldBackups(bucket);
    } catch (error) {
      console.error('Backup failed:', error);
      throw error;
    }
  });

async function cleanupOldBackups(bucketName: string) {
  const storage = new Storage();
  const bucket = storage.bucket(bucketName.replace('gs://', ''));
  
  const thirtyDaysAgo = new Date();
  thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
  
  const [files] = await bucket.getFiles();
  
  for (const file of files) {
    const [metadata] = await file.getMetadata();
    const created = new Date(metadata.timeCreated);
    
    if (created < thirtyDaysAgo) {
      await file.delete();
      console.log(`Deleted old backup: ${file.name}`);
    }
  }
}
```

### Documentation de DÃ©ploiement

**README DÃ©ploiement :**

```markdown
# ğŸš€ Guide de DÃ©ploiement Event's

## PrÃ©requis

- Node.js 20+
- Firebase CLI (`npm install -g firebase-tools`)
- AccÃ¨s au projet Firebase
- Variables d'environnement configurÃ©es

## Environnements

- **Development:** `events-dev` (Firebase project)
- **Production:** `events-prod` (Firebase project)

## DÃ©ploiement Manuel

### 1. Preview (pour test)
```bash
npm run build
firebase hosting:channel:deploy preview --expires 7d
```

### 2. Production

```bash
# VÃ©rifier les tests
npm run test

# Build
npm run build

# DÃ©ployer hosting
firebase deploy --only hosting

# DÃ©ployer functions
cd functions && npm run deploy

# DÃ©ployer rules
firebase deploy --only firestore:rules,firestore:indexes
```

## DÃ©ploiement Automatique

Les pushs sur `main` dÃ©clenchent automatiquement :

- Tests unitaires et intÃ©gration
- Build de lâ€™application
- DÃ©ploiement en production
- Notification Slack

## Rollback

En cas de problÃ¨me :

```bash
./scripts/rollback.sh
```

## Monitoring

- **Firebase Console:** https://console.firebase.google.com
- **Performance:** Firebase Performance Monitoring
- **Errors:** Sentry Dashboard
- **Logs:** Cloud Functions Logs

## Health Check

```bash
curl https://events-prod.web.app/health
```

## Support

En cas de problÃ¨me critique :

1. VÃ©rifier le status : `/health`
1. Consulter Sentry pour les erreurs
1. Rollback si nÃ©cessaire
1. Notifier lâ€™Ã©quipe sur Slack

```
-----

## 12. BONNES PRATIQUES & CONVENTIONS

### Code Review Checklist

**Avant de crÃ©er une Pull Request :**

- [ ] Code respecte les conventions de nommage
- [ ] Types TypeScript dÃ©finis pour toutes les fonctions publiques
- [ ] Tests unitaires Ã©crits pour la nouvelle fonctionnalitÃ©
- [ ] Pas de console.log() oubliÃ© (sauf logging intentionnel)
- [ ] Aucune variable d'environnement en dur dans le code
- [ ] Documentation mise Ã  jour si nÃ©cessaire
- [ ] Performance vÃ©rifiÃ©e (pas de re-renders inutiles)
- [ ] AccessibilitÃ© validÃ©e (labels, ARIA, contraste)
- [ ] Responsive testÃ© sur mobile/tablet/desktop

### Git Commit Convention

**Format :** `type(scope): message`

**Types autorisÃ©s :**

- `feat`: Nouvelle fonctionnalitÃ©
- `fix`: Correction de bug
- `docs`: Documentation uniquement
- `style`: Formatage (pas de changement de code)
- `refactor`: Refactoring (ni feat ni fix)
- `perf`: AmÃ©lioration de performance
- `test`: Ajout/modification de tests
- `chore`: TÃ¢ches de maintenance

**Exemples :**

```bash
feat(events): add auto-validation when quorum reached
fix(voting): prevent duplicate votes on same option
docs(readme): update deployment instructions
refactor(firestore): extract query logic to service
perf(dashboard): lazy load event cards
```

### Code Documentation

```typescript
/**
 * Valide automatiquement un Ã©vÃ©nement si le quorum est atteint.
 * 
 * @param eventId - L'identifiant unique de l'Ã©vÃ©nement
 * @param threshold - Pourcentage de votes "yes" requis (dÃ©faut: 0.8)
 * @returns Promise<boolean> - true si validation effectuÃ©e
 * 
 * @throws {AppError} Si l'Ã©vÃ©nement n'existe pas
 * @throws {AppError} Si l'Ã©vÃ©nement n'est pas en statut "voting"
 * 
 * @example
 * ```typescript
 * const validated = await autoValidateEvent('evt_123', 0.8);
 * if (validated) {
 *   console.log('Event automatically confirmed!');
 * }
 * ```
 */
export async function autoValidateEvent(
  eventId: string,
  threshold: number = 0.8
): Promise<boolean> {
  // Implementation
}
```

### Performance Best Practices

**âœ… Ã€ FAIRE :**

```typescript
// Utiliser React.memo pour composants lourds
export const EventCard = React.memo<EventCardProps>(({ event }) => {
  return <div>{/* ... */}</div>;
});

// Lazy loading des routes
const EventDetail = lazy(() => import('@pages/EventDetail'));

// Debounce des inputs
const debouncedSearch = useDebounce(searchQuery, 300);

// Virtual scrolling pour longues listes
import { FixedSizeList } from 'react-window';
```

**âŒ Ã€ Ã‰VITER :**

```typescript
// âŒ Re-render Ã  chaque props change
function EventCard(props) {
  // Pas de memoization
}

// âŒ Fetch dans une boucle
for (const id of userIds) {
  await fetchUser(id); // N+1 problem
}

// âŒ State trop granulaire
const [title, setTitle] = useState('');
const [date, setDate] = useState(null);
const [location, setLocation] = useState('');
// Mieux : const [formData, setFormData] = useState({...})
```

### SÃ©curitÃ© Best Practices

**Sanitization :**

```typescript
// âœ… Toujours sanitizer les inputs utilisateur
import DOMPurify from 'dompurify';

function sanitizeUserInput(input: string): string {
  return DOMPurify.sanitize(input, {
    ALLOWED_TAGS: ['b', 'i', 'em', 'strong'],
    ALLOWED_ATTR: [],
  });
}

// Utilisation
const cleanTitle = sanitizeUserInput(userInput);
```

**Validation :**

```typescript
// âœ… Valider cÃ´tÃ© client ET serveur
// Client
if (!ValidationUtils.isValidEmail(email)) {
  throw new AppError('Invalid email', ERROR_CODES.INVALID_INPUT);
}

// Serveur (Cloud Function)
export const createEvent = functions.https.onCall(async (data, context) => {
  if (!context.auth) {
    throw new functions.https.HttpsError('unauthenticated', 'Must be logged in');
  }
  
  if (!ValidationUtils.isValidEventTitle(data.title)) {
    throw new functions.https.HttpsError('invalid-argument', 'Invalid title');
  }
  
  // Proceed...
});
```

### AccessibilitÃ© (a11y) Checklist

```typescript
// âœ… Bonnes pratiques
<button
  aria-label="Vote for Saturday evening"
  onClick={handleVote}
  disabled={isLoading}
>
  <CheckIcon aria-hidden="true" />
  Vote
</button>

// Focus management
const modalRef = useRef<HTMLDivElement>(null);
useEffect(() => {
  modalRef.current?.focus();
}, []);

// Skip to content
<a href="#main-content" className="skip-link">
  Skip to main content
</a>
```

-----

**FIN DU DOCUMENT ARCHITECTURE & CODE**

*Version 1.0 ComplÃ¨te*  
*DerniÃ¨re mise Ã  jour : 8 DÃ©cembre 2025*  
*Statut : Document de rÃ©fÃ©rence actif et complet*

-----

**Ce document couvre maintenant lâ€™intÃ©gralitÃ© de lâ€™architecture technique de Eventâ€™s, de la configuration initiale jusquâ€™au dÃ©ploiement en production, en passant par le CI/CD, le monitoring et les bonnes pratiques de dÃ©veloppement.**
`,
  "design_system": `
[CONTENU DESIGN_SYSTEM_&_CHARTE_UX.TXT ICI]
`,
  "overview": `
[CONTENU OVERVIEW.TXT ICI]
`,
  "workflow": `
[CONTENU WORKFLOW.MD ICI]
`
};
```

**IMPORTANT :**

- Utilise des template literals (backticks)
- PrÃ©serve TOUS les sauts de ligne
- PrÃ©serve TOUTE la mise en forme markdown
- Nâ€™Ã©chappe PAS les caractÃ¨res spÃ©ciaux (`, â€œ, â€™, )
- Si des backticks existent dans le contenu, Ã©chappe-les avec `

### 2. GÃ©nÃ¨re index des sections par document

CrÃ©e src/data/documentSections.ts :

```typescript
export const documentSections: Record<string, Record<string, { start: number; end: number; title: string }>> = {
  "identity": {
    "1_vision": { start: 0, end: X, title: "Vision" },
    "2_mission": { start: X, end: Y, title: "Mission" },
    // [Auto-gÃ©nÃ©rÃ© en analysant les ## titres markdown]
  },
  // [Idem pour autres documents]
};
```

**MÃ©thode :**

- Parse chaque document
- DÃ©tecte les titres markdown (##, ###)
- Calcule positions start/end (index caractÃ¨res)
- GÃ©nÃ¨re structure sections

### 3. Teste le chargement

CrÃ©e src/utils/testDocuments.ts :

```typescript
import { initialDocuments } from '../data/initialDocuments';
import { documentSections } from '../data/documentSections';

export function validateDocuments() {
  const results = [];
  
  for (const [name, content] of Object.entries(initialDocuments)) {
    results.push({
      document: name,
      length: content.length,
      sections: Object.keys(documentSections[name] || {}).length,
      valid: content.length > 100 // Documents doivent avoir contenu
    });
  }
  
  return results;
}
```

Appelle cette fonction au dÃ©marrage de App.tsx et affiche rÃ©sultats dans console.

### 4. Mise Ã  jour System Instruction Agent Vision

Dans src/services/geminiAgent.ts, assure-toi que callAgentVision() charge le document workflow :

```typescript
export async function callAgentVision(
  messages: Array<{ role: string; content: string }>,
  documentsContext?: Record<string, string>
) {
  const workflowDoc = documentsContext?.workflow || initialDocuments.workflow;
  
  const systemInstruction = `
Tu es l'Agent Vision, coordinateur du systÃ¨me Event's.

${workflowDoc}

[Reste des instructions...]
`;
  
  // [Suite du code...]
}
```

### 5. Teste lâ€™accÃ¨s dans lâ€™UI

Ajoute un composant temporaire src/components/DocumentDebug.tsx :

```typescript
import { documentStore } from '../services/documentStore';

export const DocumentDebug = () => {
  const docs = documentStore.getAllDocuments();
  
  return (
    <div className="p-4 bg-gray-100 rounded">
      <h3 className="font-bold mb-2">ğŸ“š Documents ChargÃ©s</h3>
      {Object.entries(docs).map(([name, doc]) => (
        <div key={name} className="mb-2">
          <span className="font-mono text-sm">
            {name}: {doc.content.length} chars, v{doc.version}
          </span>
        </div>
      ))}
    </div>
  );
};
```

Ajoute ce composant temporairement dans App.tsx pour validation visuelle.

## Format RÃ©ponse Attendu

```
âœ… DOCUMENTS INTÃ‰GRÃ‰S

## Statistiques
- identity: 12,543 caractÃ¨res, 8 sections
- architecture: 45,234 caractÃ¨res, 15 sections
- design_system: 38,129 caractÃ¨res, 12 sections
- overview: 8,234 caractÃ¨res, 7 sections
- workflow: 15,432 caractÃ¨res, 9 sections

TOTAL: 119,572 caractÃ¨res

## Index Sections GÃ©nÃ©rÃ©
âœ… documentSections.ts crÃ©Ã© (51 sections totales)

## Tests
âœ… validateDocuments() : Tous documents valides
âœ… localStorage.initialize() : OK
âœ… Agent Vision accÃ¨de workflow : OK
âœ… DocumentDebug affiche correctement : OK

## Status
ğŸŸ¢ DOCUMENTS OPÃ‰RATIONNELS

Prochaine Ã©tape : IntÃ©gration Firebase et Cloud Functions
```

## Points de Validation Critiques

AprÃ¨s intÃ©gration, je vÃ©rifierai :

1. Les documents sont lisibles dans localStorage (DevTools)
1. Agent Vision peut lire workflow dans son system instruction
1. Pas dâ€™erreur dâ€™Ã©chappement de caractÃ¨res
1. Index sections correspond aux titres rÃ©els

Si tout est vert, on passe Ã  lâ€™intÃ©gration Firebase.

```
---

## ğŸ¤” Mon Avis sur cette Approche

### âœ… Avantages
1. **Validation progressive** : Ã‰vite erreurs accumulÃ©es
2. **VisibilitÃ© claire** : Tu vois exactement oÃ¹ on en est
3. **Point de contrÃ´le** : Tu valides avant de passer Ã  Firebase
4. **Debugging facilitÃ©** : Si problÃ¨me, on sait exactement oÃ¹

### âš ï¸ Points d'Attention
1. **Taille des documents** : ~120K caractÃ¨res dans un seul fichier TypeScript
   - Solution : Ã‡a reste OK pour TypeScript, mais surveiller build time
2. **Ã‰chappement backticks** : Si tes documents contiennent des \`\`\`, il faudra les Ã©chapper
   - Solution : L'agent devrait dÃ©tecter et gÃ©rer automatiquement

### ğŸ’¡ AmÃ©lioration SuggÃ©rÃ©e
Au lieu d'envoyer les 5 documents en une fois, envoyer un par un :
```

1. Envoie Identity.txt â†’ Agent intÃ¨gre â†’ Valide â†’ OK
1. Envoie Architecture â†’ Agent intÃ¨gre â†’ Valide â†’ OK
   [etc.]

```
**Avantage :** Si erreur d'intÃ©gration, plus facile Ã  corriger.

---

## ğŸ¯ Recommandation Finale

**Oui, cette approche est solide.** ProcÃ¨de ainsi :

1. **Maintenant** : Envoie instruction Ã‰tape 1.3 Ã  GAS
2. **Attend** : "ğŸŸ¢ PRÃŠT Ã€ RECEVOIR DOCUMENTS"
3. **Ensuite** : Envoie instruction Ã‰tape 2 + documents un par un ou tous ensemble (ton choix)
4. **Valide** : VÃ©rifie localStorage dans navigateur
5. **Continue** : Passe Ã  Firebase

**Alternative rapide** : Si tu veux aller plus vite, combine Ã‰tape 1.3 + 2 en une seule instruction avec tous les documents. Risque : Debug plus difficile si problÃ¨me.

**Mon conseil** : SÃ©pare comme tu proposes. C'est plus sÃ»r.â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹â€‹
```
